<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparing scenarios with population models â€¢ aae.pop</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing scenarios with population models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aae.pop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/get_started.html">get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/including_processes.html">Including processes</a></li>
    <li><a class="dropdown-item" href="../articles/beyond_defaults.html">Beyond defaults</a></li>
    <li><a class="dropdown-item" href="../articles/metapopulations.html">Metapopulations</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_species.html">Multiple species</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/macperch_example.html">Macquarie perch</a></li>
    <li><a class="dropdown-item" href="../articles/scenarios_example.html">Comparing scenarios</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../CODE_OF_CONDUCT.html">code of conduct</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aae-stats/aae.pop" aria-label="View source of GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comparing scenarios with population models</h1>
                        <h4 data-toc-skip class="author">Jian Yen</h4>
            
            <h4 data-toc-skip class="date">07/01/2026</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aae-stats/aae.pop/blob/main/vignettes/scenarios_example.Rmd" class="external-link"><code>vignettes/scenarios_example.Rmd</code></a></small>
      <div class="d-none name"><code>scenarios_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>A common application of population models is the comparison of
scenarios based on population outcomes. Examples include predicting
population trajectories under different scenarios of climate change,
comparing or ranking competing management scenarios, and predicting the
consequences of different ecological hypotheses. This example uses a
simplified model of population dynamics to demonstrate the comparison of
multiple scenarios, as well as several methods to speed computation when
simulating many scenarios. A detailed exploration of this approach is
outlined in <span class="citation">(Yen et al. 2021)</span> and <span class="citation">(Yen et al. 2022)</span>.</p>
</div>
<div class="section level2">
<h2 id="a-simple-population-model">A simple population model<a class="anchor" aria-label="anchor" href="#a-simple-population-model"></a>
</h2>
<p>This example will focus on a simplified model of population dynamics
for tractability. The example will consider four distinct populations
(i.e., separate populations, not a metapopulation) of the same species
with identical average vital rates in all populations. This species is
assumed to have vital rates and demographic processes similar to the
example species in the <a href="including_processes.html">Including
processes</a> vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the population matrix</span></span>
<span><span class="va">popmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">10</span>,   <span class="fl">15</span>,    <span class="fl">20</span><span class="op">)</span>,  <span class="co"># reproduction from 3-5 year olds</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,     <span class="fl">0</span><span class="op">)</span>,   <span class="co"># survival from age 1 to 2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">0.65</span>, <span class="fl">0</span>,    <span class="fl">0</span>,     <span class="fl">0</span><span class="op">)</span>,   <span class="co"># survival from age 2 to 3</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0.85</span>, <span class="fl">0</span>,     <span class="fl">0</span><span class="op">)</span>,   <span class="co"># survival from age 3 to 4</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0.9</span>,   <span class="fl">0</span><span class="op">)</span>    <span class="co"># survival from age 4 to 5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add some demographic stochasticity</span></span>
<span><span class="va">demostoch_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/masks.html">all_classes</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span> <span class="co"># affects all classes</span></span>
<span><span class="va">demostoch_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">demostoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stochasticity.html">demographic_stochasticity</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="va">demostoch_mask</span>,</span>
<span>  funs <span class="op">=</span> <span class="va">demostoch_fn</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and some environmental stochasticity</span></span>
<span><span class="va">reproduction_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="co"># only ages 3-5 reproduce</span></span>
<span><span class="va">reproduction_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">transition_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span> <span class="co"># all classes this time</span></span>
<span><span class="va">transition_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># add a random deviation to x</span></span>
<span>  <span class="va">deviation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">deviation</span></span>
<span>  </span>
<span>  <span class="co"># make sure the result isn't negative or greater than 1</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co"># return the value</span></span>
<span>  <span class="va">x</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="va">envstoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stochasticity.html">environmental_stochasticity</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">reproduction_mask</span>, <span class="va">transition_mask</span><span class="op">)</span>,</span>
<span>  funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">reproduction_fn</span>, <span class="va">transition_fn</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify a Ricker model for density dependence</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/density_dependence.html">density_dependence</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="fu"><a href="../reference/masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="co"># only adults reproduce</span></span>
<span>  funs <span class="op">=</span> <span class="fu"><a href="../reference/density_functions.html">ricker</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">40</span>, exclude <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>      <span class="co"># set k based on adult abundances</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Some more-complex processes are required to simulate the scenarios
below. One of these is the consideration of fishing regulations that
change through time, which might be captured with a
<code>add_remove_post</code> function where the proportion or number of
individuals removed changes through time:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify a function to remove a set number of adults in any given year,</span></span>
<span><span class="co">#   with an argument that can be changed through time to incorporate</span></span>
<span><span class="co">#   changing scenarios</span></span>
<span><span class="va">removals_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">remove</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># add some stochasticity in the number of removals</span></span>
<span>  <span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, lambda <span class="op">=</span> <span class="va">remove</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># check that there are enough individuals to remove,</span></span>
<span>  <span class="co">#   only remove up to sum(n) individuals</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># work out which age classes to remove, sampled</span></span>
<span>  <span class="co">#   randomly up to the total available in each</span></span>
<span>  <span class="co">#   age class</span></span>
<span>  <span class="va">n_available</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span>, times <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">removal_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_available</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">remove</span>, replace <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># expand this into a vector of removals by age class</span></span>
<span>  <span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">n_available</span><span class="op">[</span><span class="va">removal_idx</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">remove_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">remove_expanded</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">remove_expanded</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">remove</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">remove</span></span>
<span></span>
<span>  <span class="co"># and return updated abundances</span></span>
<span>  <span class="va">n</span> <span class="op">-</span> <span class="va">remove_expanded</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># collate this into a single add_remove_post object, </span></span>
<span><span class="co">#   focusing on adults</span></span>
<span><span class="va">add_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_remove.html">add_remove_post</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="fu"><a href="../reference/masks.html">all_classes</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="co"># want to focus on adults</span></span>
<span>  funs <span class="op">=</span> <span class="va">removals_fn</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The scenarios below also consider habitat restoration at multiple
sites. The effects of habitat restoration can be captured with a
<code>covariates</code> process that alters vital rates based on the
current habitat extent:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># effects of habitat condition on reproduction</span></span>
<span><span class="co">#    reductions up to 10 % if habitat is non-existent,</span></span>
<span><span class="co">#    minimal reductions if habitat reaches 50 % of </span></span>
<span><span class="co">#    its maximum extent</span></span>
<span><span class="va">reproduction_effects</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># define a nonlinear effect of habitat</span></span>
<span>  <span class="va">scale_factor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># return re-scaled survival values</span></span>
<span>  <span class="va">mat</span> <span class="op">*</span> <span class="va">scale_factor</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># effects of habitat condition on survival</span></span>
<span><span class="co">#    minimal reductions unless habitat falls</span></span>
<span><span class="co">#    below 30 % of its expected extent, up to</span></span>
<span><span class="co">#    a 5 % reduction with non-existent habitat</span></span>
<span><span class="va">survival_effects</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># define a nonlinear effect of habitat</span></span>
<span>  <span class="va">scale_factor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># return re-scaled survival values</span></span>
<span>  <span class="va">mat</span> <span class="op">*</span> <span class="va">scale_factor</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define masks</span></span>
<span><span class="va">covar_masks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># link functions to masks</span></span>
<span><span class="va">covar_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">reproduction_effects</span>,</span>
<span>  <span class="va">survival_effects</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># collate into a single object</span></span>
<span><span class="va">covars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="va">covar_masks</span>,</span>
<span>  funs <span class="op">=</span> <span class="va">covar_funs</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="defining-scenarios">Defining scenarios<a class="anchor" aria-label="anchor" href="#defining-scenarios"></a>
</h2>
<p>This example considers a set of scenarios based on combinations of
four generalised management actions implemented across four populations
(four distinct locations). The actions are:</p>
<ul>
<li><p>increase habitat extent by 40 % at the location with the least
habitat</p></li>
<li><p>increase habitat extent by 15 % each at the two locations with
the least habitat</p></li>
<li><p>regulate and enforce a complete ban on fishing at two
locations</p></li>
<li><p>reduce fishing pressure through regulation and partial
enforcement at all locations</p></li>
</ul>
<p>The first and second actions are alternatives to one another, as are
the third and fourth actions. Therefore, there are 9 possible
combinations of actions are:</p>
<ul>
<li><p>habitat restoration at one location, fishing regulation at two
locations</p></li>
<li><p>habitat restoration at one location, fishing regulation at all
locations</p></li>
<li><p>habitat restoration at two locations, fishing regulation at two
locations</p></li>
<li><p>habitat restoration at two locations, fishing regulation at all
locations</p></li>
<li><p>habitat restoration at one location, no fishing
regulation</p></li>
<li><p>habitat restoration at two locations, no fishing
regulation</p></li>
<li><p>no habitat restoration, fishing regulation at two
locations</p></li>
<li><p>no habitat restoration, fishing regulation at all
locations</p></li>
<li><p>no habitat restoration, no fishing regulation</p></li>
</ul>
<p>The four actions are hypothetical but can be assumed to have similar
financial costs. Therefore, the purpose of scenario testing in this case
is to identify the benefits of different combinations of actions
relative to one another and relative to taking no action.</p>
<p>The different actions can be implemented in <code>aae.pop</code>
through functions that convert actions to sequences of covariates and
arguments that influence the <code>covariates</code> and
<code>density_dependence_n</code> processes in <code>simulate</code>.
For habitat restoration, this function might look like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to define habitat extent including restoration effects</span></span>
<span><span class="va">restore</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">amount</span>, <span class="va">current</span>, <span class="va">ntime</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># pull out the worst n sites</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">current</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># create sequences of habitat extent at all sites</span></span>
<span>  <span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>    <span class="va">rbind</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ntime</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">current</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add habitat over a period of 5 years, up to `amount`</span></span>
<span>  <span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">amount</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">amount</span>, <span class="va">ntime</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># update sequences of habitat extent in the worst n sites  </span></span>
<span>  <span class="va">current</span><span class="op">[</span>, <span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span></span>
<span>    <span class="va">current</span><span class="op">[</span>, <span class="va">idx</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,</span>
<span>    <span class="fl">1</span>,</span>
<span>    <span class="va">add</span>,</span>
<span>    <span class="st">"+"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return</span></span>
<span>  <span class="va">current</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>To incorporate scenarios of fishing regulation simply requires an
<code>args</code> element for <code>add_remove_post</code> that
specifies the average number of fish removed per year. In this case,
unregulated fishing is assumed to remove 50 fish per year at a site,
with partial regulation reducing this to 25 fish removed per year.</p>
</div>
<div class="section level2">
<h2 id="simulating-many-scenarios">Simulating many scenarios<a class="anchor" aria-label="anchor" href="#simulating-many-scenarios"></a>
</h2>
<p>There are nine possible combinations of actions (nine management
<em>options</em>) and four populations. Simulating population dynamics
in this case requires at least 36 simulations. This section will
demonstrate the simplest way to set up and simulate dynamics for many
scenarios. The following section will present several methods to speed
up computation in very large cases (e.g., thousands or even millions of
scenarios).</p>
<div class="section level3">
<h3 id="setting-up-the-model">Setting up the model<a class="anchor" aria-label="anchor" href="#setting-up-the-model"></a>
</h3>
<p>With 36 simulations, each taking perhaps a few seconds, there is no
real need to speed up simulations. In this case, the complexity is in
setting up and defining the scenarios and interpreting their outputs.
Set up requires simulations for each of the four populations under each
of the management actions. The following code does this, using the
<code>calculate_quasi_extinction</code> function defined in the <a href="macperch_example.html">Macquarie perch</a> example to summarise
population trajectories:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up some basic parameters</span></span>
<span><span class="va">npop</span> <span class="op">&lt;-</span> <span class="fl">4</span>      <span class="co"># how many populations?</span></span>
<span><span class="va">ntime</span> <span class="op">&lt;-</span> <span class="fl">50</span>    <span class="co"># how many years to simulate?</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">100</span>   <span class="co"># how many replicates?</span></span>
<span></span>
<span><span class="co"># simulate current habitat extent (between 20 % and 60 %)</span></span>
<span><span class="va">habitat_extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">npop</span>, min <span class="op">=</span> <span class="fl">0.2</span>, max <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define a population model for each of the four populations</span></span>
<span><span class="va">popdyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">npop</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="../reference/dynamics.html">dynamics</a></span><span class="op">(</span></span>
<span>    <span class="fu">envstoch</span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span>,   <span class="co"># alter the matrix slightly for each population</span></span>
<span>    <span class="va">envstoch</span>,</span>
<span>    <span class="va">demostoch</span>,</span>
<span>    <span class="va">dd</span>,</span>
<span>    <span class="va">add_remove</span>,</span>
<span>    <span class="va">covars</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define initial abundances in each population</span></span>
<span><span class="va">initial_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>  <span class="va">npop</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">5</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">25</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the habitat restoration actions</span></span>
<span><span class="va">habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"restore_none"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span>, amount <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,   <span class="co"># no sites restored</span></span>
<span>  <span class="st">"restore_one"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, amount <span class="op">=</span> <span class="fl">0.40</span><span class="op">)</span>, <span class="co"># one site increased by 40 %</span></span>
<span>  <span class="st">"restore_two"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>, amount <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span>  <span class="co"># two sites each increased by 15 %</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the fishing regulation actions</span></span>
<span><span class="va">fishing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"regulate_none"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>remove <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># baseline fishing pressure</span></span>
<span>  <span class="st">"regulate_two"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>remove <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,     <span class="co"># complete halt at two sites</span></span>
<span>  <span class="st">"regulate_all"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>remove <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">25</span>, <span class="fl">25</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>    <span class="co"># reduction at all sites</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define all combinations of actions</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  habitat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">habitat</span><span class="op">)</span>,</span>
<span>  fishing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">fishing</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop through each scenario</span></span>
<span><span class="va">quasi_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">npop</span><span class="op">)</span>  <span class="co"># empty matrix to store extinction risk estimates</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># pull out the relevant actions</span></span>
<span>  <span class="va">hab_tmp</span> <span class="op">&lt;-</span> <span class="va">habitat</span><span class="op">[</span><span class="va">scenarios</span><span class="op">$</span><span class="va">habitat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  <span class="va">fish_tmp</span> <span class="op">&lt;-</span> <span class="va">fishing</span><span class="op">[</span><span class="va">scenarios</span><span class="op">$</span><span class="va">fishing</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># define habitat extent taking into account restoration</span></span>
<span>  <span class="va">extent_tmp</span> <span class="op">&lt;-</span><span class="fu">restore</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">hab_tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    amount <span class="op">=</span> <span class="va">hab_tmp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    current <span class="op">=</span> <span class="va">habitat_extent</span>,</span>
<span>    ntime <span class="op">=</span> <span class="va">ntime</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># the populations are independent, so can be run simultaneously </span></span>
<span>  <span class="co">#   with lapply, mapply, or with a for loop</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">popdyn</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sims</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>      <span class="va">popdyn</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      nsim <span class="op">=</span> <span class="va">nsim</span>,</span>
<span>      init <span class="op">=</span> <span class="va">initial_abundance</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>,</span>
<span>      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="../reference/covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">extent_tmp</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        add_remove_post <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>remove <span class="op">=</span> <span class="va">fish_tmp</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># summarise the trajectories</span></span>
<span>  <span class="va">quasi_ext</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="va">sims</span>, </span>
<span>    <span class="va">calculate_quasi_extinction</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">10</span>,     <span class="co"># the quasi-extinction level</span></span>
<span>    subset <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,       <span class="co"># focus on adults</span></span>
<span>    include <span class="op">=</span> <span class="cn">TRUE</span>      <span class="co"># less than or equal to threshold</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The simulation approach demonstrated here is relatively
comprehensive, considering every feasible combination of actions and
simulating 1000 replicate trajectories for each population under each
scenario. Extensions to this might explore additional sources of
variation, such as using a range of initial conditions or including
variation in other covariates (e.g., weather or climate). In this
particular example, the fishing action was also static, with the
<code>regulate_two</code> action always regulating the same two
populations (locations 1 and 2).</p>
</div>
<div class="section level3">
<h3 id="interpreting-the-outputs">Interpreting the outputs<a class="anchor" aria-label="anchor" href="#interpreting-the-outputs"></a>
</h3>
<p>The quasi-extinction estimates can be interpreted directly for each
population under each of the nine scenarios:</p>
<pre><code><span><span class="co">##        habitat       fishing population 1 population 2 population 3</span></span>
<span><span class="co">## 1 restore_none regulate_none         0.96         0.96         0.92</span></span>
<span><span class="co">## 2  restore_one regulate_none         0.96         0.96         0.91</span></span>
<span><span class="co">## 3  restore_two regulate_none         0.96         0.96         0.93</span></span>
<span><span class="co">## 4 restore_none  regulate_two         0.00         0.00         0.92</span></span>
<span><span class="co">## 5  restore_one  regulate_two         0.00         0.00         0.92</span></span>
<span><span class="co">## 6  restore_two  regulate_two         0.00         0.00         0.91</span></span>
<span><span class="co">## 7 restore_none  regulate_all         0.08         0.04         0.06</span></span>
<span><span class="co">## 8  restore_one  regulate_all         0.07         0.05         0.06</span></span>
<span><span class="co">## 9  restore_two  regulate_all         0.07         0.05         0.05</span></span>
<span><span class="co">##   population 4</span></span>
<span><span class="co">## 1         0.93</span></span>
<span><span class="co">## 2         0.94</span></span>
<span><span class="co">## 3         0.94</span></span>
<span><span class="co">## 4         0.94</span></span>
<span><span class="co">## 5         0.94</span></span>
<span><span class="co">## 6         0.94</span></span>
<span><span class="co">## 7         0.06</span></span>
<span><span class="co">## 8         0.06</span></span>
<span><span class="co">## 9         0.04</span></span></code></pre>
<p>These results highlight an interesting pattern. Fishing regulation
clearly has a major impact on population trajectories, with a complete
ban on fishing reducing extinction risk almost to zero in regulated
populations. However, the remaining (unregulated) populations still have
relatively high quasi-extinction risks. This highlights a conceptual
challenge when results are spread over multiple populations: how much is
an individual population worth?</p>
<p>Itâ€™s possible to dig into this with some additional summary
statistics that augment the population-level estimates of
quasi-extinction risk:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># average quasi-extinction risk</span></span>
<span><span class="va">average_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">quasi_ext</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># geometric mean quasi-extinction risk</span></span>
<span><span class="va">geom_ave_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">quasi_ext</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># probability that at least one population becomes (quasi) extinct</span></span>
<span><span class="va">one_or_more_ext</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">quasi_ext</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the probability of persistence (i.e., avoiding
extinction) can often be a useful output:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># probability of persistence for all populations under each scenario</span></span>
<span><span class="va">pr_persist</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">quasi_ext</span></span>
<span></span>
<span><span class="co"># probability that at least one population persists</span></span>
<span><span class="va">one_or_more_persist</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">quasi_ext</span>, <span class="fl">1</span>, <span class="va">prod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># probability that all four populations persist</span></span>
<span><span class="va">all_persist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">pr_persist</span>, <span class="fl">1</span>, <span class="va">prod</span><span class="op">)</span></span></code></pre></div>
<p>These outputs give a more-complete picture of the relative risk under
each of the nine scenarios:</p>
<pre><code><span><span class="co">##   Habitat action Fishing action Average risk Geometric average risk</span></span>
<span><span class="co">## 1   restore_none  regulate_none         0.94                   0.94</span></span>
<span><span class="co">## 2    restore_one  regulate_none         0.94                   0.94</span></span>
<span><span class="co">## 3    restore_two  regulate_none         0.95                   0.95</span></span>
<span><span class="co">## 4   restore_none   regulate_two         0.46                   0.02</span></span>
<span><span class="co">## 5    restore_one   regulate_two         0.46                   0.02</span></span>
<span><span class="co">## 6    restore_two   regulate_two         0.46                   0.03</span></span>
<span><span class="co">## 7   restore_none   regulate_all         0.06                   0.06</span></span>
<span><span class="co">## 8    restore_one   regulate_all         0.06                   0.06</span></span>
<span><span class="co">## 9    restore_two   regulate_all         0.05                   0.05</span></span>
<span><span class="co">##   Pr(at least one extinct) Pr(at least one persist) Pr(all persist)</span></span>
<span><span class="co">## 1                     1.00                     0.21            0.00</span></span>
<span><span class="co">## 2                     1.00                     0.22            0.00</span></span>
<span><span class="co">## 3                     1.00                     0.20            0.00</span></span>
<span><span class="co">## 4                     1.00                     1.00            0.00</span></span>
<span><span class="co">## 5                     0.99                     1.00            0.01</span></span>
<span><span class="co">## 6                     0.99                     1.00            0.01</span></span>
<span><span class="co">## 7                     0.21                     1.00            0.79</span></span>
<span><span class="co">## 8                     0.21                     1.00            0.79</span></span>
<span><span class="co">## 9                     0.20                     1.00            0.80</span></span></code></pre>
<p>These outputs provide a clearer picture of the relative risks of the
different scenarios, supporting decisions based on priorities for a
single versus multiple populations. In this case, there is little
justification for investment in habitat restoration but plenty of reason
to invest in regulating fishing. A focus on persistence of a single
population doesnâ€™t distinguish the two fishing actions (partial or
complete ban), yet a focus on maintaining all populations indicates that
partial regulation across all locations is likely to be a much more
effective strategy, reducing the risk that any one of the populations
will become extinct.</p>
<p>Many variants of these summaries exist, such as probabilities that 2
or more populations persist, average extinction risk weighted by a
measure of a populationâ€™s value, or metrics based on expected genetic or
functional diversity under each scenarios.</p>
<p>The outputs of this modelling approach might support a recommendation
in their own right, or might guide the development of alternative
management actions, such as more-nuanced fishing regulations or more
extensive habitat restoration scenarios. Alternatively, model outputs
might highlight flaws in model construction. For example, if habitat
restoration is known to be more effective than indicated by the results
above, this might indicate knowledge gaps that limit the current modelâ€™s
applicability.</p>
</div>
</div>
<div class="section level2">
<h2 id="speeding-up-simulations">Speeding up simulations<a class="anchor" aria-label="anchor" href="#speeding-up-simulations"></a>
</h2>
<p>The models above require many repeated simulations. This section
outlines two ways to speed up simulations when comparing many scenarios.
Both methods are relatively complex to set up and may only give marginal
improvements (or no improvement at all), so are not recommended as
default approaches in <code>aae.pop</code>.</p>
<div class="section level3">
<h3 id="running-in-parallel">Running in parallel<a class="anchor" aria-label="anchor" href="#running-in-parallel"></a>
</h3>
<p>Importantly, the simulations of different scenarios are entirely
independent of one another, which makes this an <em>embarrassingly
parallel</em> problem. What this means is that the simulations can be
split up and run simultaneously, assuming sufficient cores and
memory.</p>
<p>The <code>future</code> and <code>future.apply</code> R packages make
it easy to deal with embarrassingly parallel problems in R. These
packages allow users to set up a general problem statement to be
evaluated in a <em>future</em> that can be specified (and changed) when
actually running the code. Practically, this means writing one bit of
code that can be used with several possible <em>futures</em>, including
a personal computer with one or more cores, a cloud compute server, a
large HPC system, or spread across multiple nodes in a distributed
compute system. This is especially useful because the code can be
developed and tested on a local computer before being sent off to a
more-powerful system for extended model runs.</p>
<p>One trick to (easily) running embarrassingly parallel problems in R
is the use of <code>_apply</code> statements (e.g.Â <code>sapply</code>,
<code>lapply</code>) in place of <code>for</code> loops when the
contents of the loop does not depend on previous iterations. This
process can be slightly confusing at first but, in its simplest form,
simply requires wrapping the contents of the loop in a function and then
passing this function to <code>lapply</code> or <code>sapply</code>.</p>
<p>In R, the first step is to wrap main steps of the <code>for</code>
loop in a function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># need a function that takes `scenarios` as input and</span></span>
<span><span class="co">#   spits out the simulation outputs</span></span>
<span><span class="va">run_scenario</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">scenario</span>,</span>
<span>  <span class="va">popdyn</span>,</span>
<span>  <span class="va">habitat</span>,</span>
<span>  <span class="va">fishing</span>,</span>
<span>  <span class="va">habitat_extent</span>, </span>
<span>  <span class="va">initial_abundance</span>,</span>
<span>  <span class="va">ntime</span>, </span>
<span>  <span class="va">nsim</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># pull out the relevant actions</span></span>
<span>  <span class="co">#  scenario is now a vector with two elements, habitat and fishing</span></span>
<span>  <span class="va">hab_tmp</span> <span class="op">&lt;-</span> <span class="va">habitat</span><span class="op">[</span><span class="va">scenario</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  <span class="va">fish_tmp</span> <span class="op">&lt;-</span> <span class="va">fishing</span><span class="op">[</span><span class="va">scenario</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># define habitat extent taking into account restoration</span></span>
<span>  <span class="va">extent_tmp</span> <span class="op">&lt;-</span><span class="fu">restore</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">hab_tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    amount <span class="op">=</span> <span class="va">hab_tmp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    current <span class="op">=</span> <span class="va">habitat_extent</span>,</span>
<span>    ntime <span class="op">=</span> <span class="va">ntime</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># the populations are independent, so can be run simultaneously </span></span>
<span>  <span class="co">#   with lapply, mapply, or with a for loop</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">popdyn</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sims</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>      <span class="va">popdyn</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      nsim <span class="op">=</span> <span class="va">nsim</span>,</span>
<span>      init <span class="op">=</span> <span class="va">initial_abundance</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span>,</span>
<span>      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="../reference/covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">extent_tmp</span><span class="op">[</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        add_remove_post <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>remove <span class="op">=</span> <span class="va">fish_tmp</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># summarise the trajectories and return these values</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="va">sims</span>, </span>
<span>    <span class="va">calculate_quasi_extinction</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">10</span>,     <span class="co"># the quasi-extinction level</span></span>
<span>    subset <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,       <span class="co"># focus on adults</span></span>
<span>    include <span class="op">=</span> <span class="cn">TRUE</span>      <span class="co"># less than or equal to threshold</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function can be passed to one of the functions in the
<code>future.apply</code> package, which provides versions of Râ€™s
standard <code>apply</code> functions that work with the
<code>future</code> package. This example uses the
<code>multisession</code> evaluation future, which will work on Windows
or Unix-like systems (including OSX), and launches multiple R sessions
running in parallel. The default number of sessions launched by
<code>multisession</code> can be viewed with the
<code><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores()</a></code> function and changed by specifying a
<code>workers</code> argument in <code>multisession</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set the evaluation future, may require the R package library</span></span>
<span><span class="co">#   (can be viewed with .libPaths()) to be passed directly with </span></span>
<span><span class="co">#   the `rscript_libs` option if using network drives</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use `apply` to evaluate the run_scenario function once </span></span>
<span><span class="co">#   for each scenario, running up to availableCores()</span></span>
<span><span class="co">#   scenarios in parallel</span></span>
<span><span class="va">quasi_ext_parallel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://future.apply.futureverse.org/reference/future_apply.html" class="external-link">future_apply</a></span><span class="op">(</span></span>
<span>  <span class="va">scenarios</span>,                    <span class="co"># matrix/data.frame of scenaios</span></span>
<span>  MARGIN <span class="op">=</span> <span class="fl">1</span>,                   <span class="co"># margin of scenarios to iterate over, 1 is rows, 2 is columns</span></span>
<span>  FUN <span class="op">=</span> <span class="va">run_scenario</span>,           <span class="co"># function to call on each row of scenarios</span></span>
<span>  popdyn <span class="op">=</span> <span class="va">popdyn</span>,              <span class="co"># other arguments to FUN</span></span>
<span>  habitat <span class="op">=</span> <span class="va">habitat</span>,</span>
<span>  fishing <span class="op">=</span> <span class="va">fishing</span>,</span>
<span>  habitat_extent <span class="op">=</span> <span class="va">habitat_extent</span>, </span>
<span>  initial_abundance <span class="op">=</span> <span class="va">initial_abundance</span>,</span>
<span>  ntime <span class="op">=</span> <span class="va">ntime</span>, </span>
<span>  nsim <span class="op">=</span> <span class="va">nsim</span>,</span>
<span>  future.seed <span class="op">=</span> <span class="cn">TRUE</span>            <span class="co"># tells future that there are RNG calls in run_scenario</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># it can be useful to reset the evaluation future, both to </span></span>
<span><span class="co">#   avoid unexpected behaviour within the main R session</span></span>
<span><span class="co">#   and to shut down any background workers. The sequential</span></span>
<span><span class="co">#   evaluation is the default R behaviour (not running anything</span></span>
<span><span class="co">#   in parallel)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span></code></pre></div>
<p>This generates outputs similar to those above:</p>
<pre><code><span><span class="co">##        habitat       fishing population 1 population 2 population 3</span></span>
<span><span class="co">## 1 restore_none regulate_none         0.97         0.96         0.93</span></span>
<span><span class="co">## 2  restore_one regulate_none         0.95         0.96         0.92</span></span>
<span><span class="co">## 3  restore_two regulate_none         0.96         0.96         0.93</span></span>
<span><span class="co">## 4 restore_none  regulate_two         0.00         0.00         0.91</span></span>
<span><span class="co">## 5  restore_one  regulate_two         0.00         0.00         0.91</span></span>
<span><span class="co">## 6  restore_two  regulate_two         0.00         0.00         0.92</span></span>
<span><span class="co">## 7 restore_none  regulate_all         0.06         0.04         0.05</span></span>
<span><span class="co">## 8  restore_one  regulate_all         0.07         0.05         0.06</span></span>
<span><span class="co">## 9  restore_two  regulate_all         0.06         0.03         0.06</span></span>
<span><span class="co">##   population 4</span></span>
<span><span class="co">## 1         0.94</span></span>
<span><span class="co">## 2         0.94</span></span>
<span><span class="co">## 3         0.93</span></span>
<span><span class="co">## 4         0.94</span></span>
<span><span class="co">## 5         0.92</span></span>
<span><span class="co">## 6         0.94</span></span>
<span><span class="co">## 7         0.04</span></span>
<span><span class="co">## 8         0.05</span></span>
<span><span class="co">## 9         0.05</span></span></code></pre>
<p>The quasi-extinction estimates will not be identical to those above
because this example does not set a seed. Even with a seed, this example
is unlikely to generate the same results as above because the scenarios
are evaluated in parallel in separate R sessions, which introduces
multiple RNG streams and changes the order of execution of
scenarios.</p>
<p>This example demonstrates one way in which scenarios can be run in
parallel. An alternative in this case would be to run the internal loop
(over each population) in parallel, either leaving the outer loop as a
<code>for</code> loop or running both in parallel. The benefits of these
different approaches will depend on two things: the computing setup
available and the relative runtime of each step. The computing setup
will determine how many different things can be run simultaneously
(typically limited by number of cores or amount of memory). Relative
runtime matters because there is some overhead to running things in
parallel. This overhead can slow things sufficiently that there is no
benefit and sometimes a cost to running really quick bits of code in
parallel. In general, at least on a personal computer, running more
time-consuming bits of code in parallel is the best choice.</p>
</div>
<div class="section level3">
<h3 id="not-so-meta-populations">Not-so-meta populations<a class="anchor" aria-label="anchor" href="#not-so-meta-populations"></a>
</h3>
<p>There is one less-obvious option for simulations of multiple,
independent populations: running all populations as a single
<code>metapopulation</code> with no dispersal. This method has
computational benefits because the calculations within
<code>simulate</code> are vectorised, which can make operations on one
big matrix faster than repeating those operations on multiple, smaller
matrices. However, this is a complex method to set up primarily because
the <code>mask</code>/<code>function</code> approach used in
<code>aae.pop</code> does not yet work neatly with metapopulations.</p>
<p>Setting up a <code>metapopulation</code> for this purpose requires
redefinition of the <code>density_dependence_n</code> and
<code>covariates</code> processes because neither of these was set up to
handle arguments for multiple populations simultaneously. The first step
is to define the base <code>metapopulation</code> dynamics object:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a population model for each of the four populations in popdyn</span></span>
<span><span class="co">#   but without the add_remove_post or covariates components,</span></span>
<span><span class="co">#   which will be redefined below</span></span>
<span><span class="va">popmat_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">popdyn</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">popdyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">popmat_list</span>,</span>
<span>  <span class="va">dynamics</span>,</span>
<span>  <span class="va">envstoch</span>,</span>
<span>  <span class="va">demostoch</span>,</span>
<span>  <span class="va">dd</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># define a dummy metapopulation structure with one</span></span>
<span><span class="co">#   "dispersal" link</span></span>
<span><span class="va">metapopstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">metapopstr</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># define a dummy dispersal link that has zero probability</span></span>
<span><span class="co">#   of any movements</span></span>
<span><span class="va">dispersal_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">disp_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dispersal.html">dispersal</a></span><span class="op">(</span><span class="va">dispersal_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine this into a metapopulation object</span></span>
<span><span class="va">metapopdyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metapopulation.html">metapopulation</a></span><span class="op">(</span><span class="va">metapopstr</span>, <span class="va">popdyn</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">disp_tmp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The second step involves redefining the <code>add_remove_post</code>
and <code>covariates</code> processes to use masks that identify the
correct elements of the metapopulation vector (which now has 20
elements, 5 for each population) and to use functions that select the
correct arguments for each population. The latter approach is also
demonstrated in the <a href="metapopulations.html">Metapopulation</a>
vignette and in the help file for the <code>metapopulations</code>
function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># wrapper function to define the removals function for each</span></span>
<span><span class="co">#   population (specified with idx)</span></span>
<span><span class="va">define_removals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">remove</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># add some stochasticity in the number of removals</span></span>
<span>    <span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, lambda <span class="op">=</span> <span class="va">remove</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="co"># check that there are enough individuals to remove,</span></span>
<span>    <span class="co">#   only remove up to sum(n) individuals</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># work out which age classes to remove, sampled</span></span>
<span>    <span class="co">#   randomly up to the total available in each</span></span>
<span>    <span class="co">#   age class</span></span>
<span>    <span class="va">n_available</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span>, times <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">removal_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_available</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">remove</span>, replace <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># expand this into a vector of removals by age class</span></span>
<span>    <span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">n_available</span><span class="op">[</span><span class="va">removal_idx</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">remove_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">remove_expanded</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="va">remove_expanded</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">remove</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">remove</span></span>
<span>    </span>
<span>    <span class="co"># and return updated abundances</span></span>
<span>    <span class="va">n</span> <span class="op">-</span> <span class="va">remove_expanded</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># combine the masks for adults of each population with</span></span>
<span><span class="co">#   the removals function defined for populations 1-4</span></span>
<span><span class="va">add_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_remove.html">add_remove_post</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/masks.html">all_classes</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/masks.html">all_classes</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/masks.html">all_classes</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">13</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/masks.html">all_classes</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">18</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">define_removals</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="fu">define_removals</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="fu">define_removals</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="fu">define_removals</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># wrapper function to define the reproduction covariate effects</span></span>
<span><span class="co">#   for each population (specified with idx)</span></span>
<span><span class="va">define_reprod_effects</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">4</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># define a nonlinear effect of habitat</span></span>
<span>    <span class="va">scale_factor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">beta</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># return re-scaled survival values</span></span>
<span>    <span class="va">mat</span> <span class="op">*</span> <span class="va">scale_factor</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># wrapper function to define the survival covariate effects</span></span>
<span><span class="co">#   for each population (specified with idx)</span></span>
<span><span class="va">define_surv_effects</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">beta</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># define a nonlinear effect of habitat</span></span>
<span>    <span class="va">scale_factor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">beta</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># return re-scaled survival values</span></span>
<span>    <span class="va">mat</span> <span class="op">*</span> <span class="va">scale_factor</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># helper function to define a reproduction mask for each</span></span>
<span><span class="co">#   population (specified with idx)</span></span>
<span><span class="va">define_reprod_mask</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">idy</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="va">idx</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/row.html" class="external-link">row</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="va">idy</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/col.html" class="external-link">col</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span> <span class="op">+</span> <span class="va">idy</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># define masks for reproduction and transitions for each</span></span>
<span><span class="co">#   population</span></span>
<span><span class="va">covar_masks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">define_reprod_mask</span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_reprod_mask</span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_reprod_mask</span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_reprod_mask</span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/masks.html">transition</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/masks.html">transition</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/masks.html">transition</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/masks.html">transition</a></span><span class="op">(</span><span class="va">metapopdyn</span><span class="op">$</span><span class="va">matrix</span>, dims <span class="op">=</span> <span class="fl">16</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine reproduction and survival covariate effects into</span></span>
<span><span class="co">#   a list</span></span>
<span><span class="va">covar_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">define_reprod_effects</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_reprod_effects</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_reprod_effects</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_reprod_effects</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_surv_effects</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_surv_effects</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_surv_effects</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="fu">define_surv_effects</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># collate into a single covariates object</span></span>
<span><span class="va">covars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covariates.html">covariates</a></span><span class="op">(</span></span>
<span>  masks <span class="op">=</span> <span class="va">covar_masks</span>,</span>
<span>  funs <span class="op">=</span> <span class="va">covar_funs</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The final step is to update the <code>metapopulation</code> dynamics
object with the new <code>density_dependence_n</code> and
<code>covariates</code> objects and use this to simulate
(meta)population trajectories under each scenario.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># update the metapopulation dynamics object</span></span>
<span><span class="va">metapopdyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">metapopdyn</span>, <span class="va">add_remove</span>, <span class="va">covars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a new initial abundance vector that has the same</span></span>
<span><span class="co">#   values as above but is a vector rather than matrix</span></span>
<span><span class="va">initial_abundance_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial_abundance</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop through each scenario</span></span>
<span><span class="va">quasi_ext_metapop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">npop</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># pull out the relevant actions</span></span>
<span>  <span class="va">hab_tmp</span> <span class="op">&lt;-</span> <span class="va">habitat</span><span class="op">[</span><span class="va">scenarios</span><span class="op">$</span><span class="va">habitat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  <span class="va">fish_tmp</span> <span class="op">&lt;-</span> <span class="va">fishing</span><span class="op">[</span><span class="va">scenarios</span><span class="op">$</span><span class="va">fishing</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># define habitat extent taking into account restoration</span></span>
<span>  <span class="va">extent_tmp</span> <span class="op">&lt;-</span><span class="fu">restore</span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">hab_tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    amount <span class="op">=</span> <span class="va">hab_tmp</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    current <span class="op">=</span> <span class="va">habitat_extent</span>,</span>
<span>    ntime <span class="op">=</span> <span class="va">ntime</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># only simulating a single metapopulation this time</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>    <span class="va">metapopdyn</span>,</span>
<span>    nsim <span class="op">=</span> <span class="va">nsim</span>,</span>
<span>    init <span class="op">=</span> <span class="va">initial_abundance_meta</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      covariates <span class="op">=</span> <span class="fu"><a href="../reference/covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">extent_tmp</span><span class="op">)</span>,</span>
<span>      add_remove_post <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>remove <span class="op">=</span> <span class="va">fish_tmp</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>    </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># summarise the trajectories, with one step first to</span></span>
<span>  <span class="co">#   subset the populations back into their own objects</span></span>
<span>  <span class="va">sims_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sims</span>, subset <span class="op">=</span> <span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">quasi_ext_metapop</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="va">sims_list</span>,</span>
<span>    <span class="va">calculate_quasi_extinction</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">10</span>,     <span class="co"># the quasi-extinction level</span></span>
<span>    subset <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,       <span class="co"># focus on adults</span></span>
<span>    include <span class="op">=</span> <span class="cn">TRUE</span>      <span class="co"># less than or equal to threshold</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>As before, the quasi-extinction estimates can be interpreted directly
for each population under each of the nine scenarios. These values will
differ from those shown above because this example does not set a RNG
seed.</p>
<pre><code><span><span class="co">##        habitat       fishing population 1 population 2 population 3</span></span>
<span><span class="co">## 1 restore_none regulate_none         0.96         0.96         0.92</span></span>
<span><span class="co">## 2  restore_one regulate_none         0.96         0.96         0.93</span></span>
<span><span class="co">## 3  restore_two regulate_none         0.96         0.96         0.93</span></span>
<span><span class="co">## 4 restore_none  regulate_two         0.00         0.00         0.93</span></span>
<span><span class="co">## 5  restore_one  regulate_two         0.00         0.00         0.93</span></span>
<span><span class="co">## 6  restore_two  regulate_two         0.00         0.00         0.92</span></span>
<span><span class="co">## 7 restore_none  regulate_all         0.08         0.07         0.04</span></span>
<span><span class="co">## 8  restore_one  regulate_all         0.07         0.06         0.06</span></span>
<span><span class="co">## 9  restore_two  regulate_all         0.06         0.06         0.05</span></span>
<span><span class="co">##   population 4</span></span>
<span><span class="co">## 1         0.94</span></span>
<span><span class="co">## 2         0.93</span></span>
<span><span class="co">## 3         0.94</span></span>
<span><span class="co">## 4         0.93</span></span>
<span><span class="co">## 5         0.94</span></span>
<span><span class="co">## 6         0.93</span></span>
<span><span class="co">## 7         0.06</span></span>
<span><span class="co">## 8         0.06</span></span>
<span><span class="co">## 9         0.05</span></span></code></pre>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-yen2022" class="csl-entry">
Yen, Jian D.L., Charles R. Todd, Joanne Sharley, Annique Harris, William
L. Geary, Ella Kelly, Alexandra Pavlova, et al. 2022.
<span>â€œEstablishing New Populations in Water-Secure Locations May
Benefit Species Persistence More Than Interventions in Water-Stressed
Locations.â€</span> <em>Biological Conservation</em> 276. <a href="https://www.sciencedirect.com/science/article/pii/S0006320722003652" class="external-link">https://www.sciencedirect.com/science/article/pii/S0006320722003652</a>.
</div>
<div id="ref-yen2021" class="csl-entry">
Yen, Jian D.L., Zeb Tonkin, Charles Todd, Daniel Stoessel, Tarmo A.
Raadik, and Jarod Lyon. 2021. <span>â€œUsing Population Models to Estimate
Expected Benefit of Management Actions: Case Studies on Six Aquatic
Species.â€</span> <em>Arthur Rylah Institute for Environmental Research:
Technical Report Series</em> XYZ. <a href="https://www.ari.vic.gov.au/__data/assets/pdf_file/0027/552681/ARI-Technical-Report-331-Using-population-models-to-estimate-expected-benefit-of-management-actions.pdf" class="external-link">https://www.ari.vic.gov.au/__data/assets/pdf_file/0027/552681/ARI-Technical-Report-331-Using-population-models-to-estimate-expected-benefit-of-management-actions.pdf</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jian Yen, Arthur Rylah Institute for Environmental Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
