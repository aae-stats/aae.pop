<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Moving beyond default settings in aae.pop • aae.pop</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Moving beyond default settings in aae.pop">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aae.pop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1.9007</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/get_started.html">get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/including_processes.html">Including processes</a></li>
    <li><a class="dropdown-item" href="../articles/beyond_defaults.html">Beyond defaults</a></li>
    <li><a class="dropdown-item" href="../articles/metapopulations.html">Metapopulations</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_species.html">Multiple species</a></li>
    <li><a class="dropdown-item" href="../articles/templates.html">Species templates</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/macperch_example.html">Macquarie perch</a></li>
    <li><a class="dropdown-item" href="../articles/scenarios_example.html">Comparing scenarios</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aae-stats/aae.pop"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Moving beyond default settings in aae.pop</h1>
                        <h4 data-toc-skip class="author">Jian Yen</h4>
            
            <h4 data-toc-skip class="date">07/01/2026</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aae-stats/aae.pop/blob/main/vignettes/beyond_defaults.Rmd" class="external-link"><code>vignettes/beyond_defaults.Rmd</code></a></small>
      <div class="d-none name"><code>beyond_defaults.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>aae.pop</code> sets default options to speed the process of
defining and simulating population dynamics. These defaults are
acceptable in some cases but are unlikely to suit all applications. This
vignette covers the primary settings and some useful alternatives.</p>
</div>
<div class="section level2">
<h2 id="changing-simulation-settings">Changing simulation settings<a class="anchor" aria-label="anchor" href="#changing-simulation-settings"></a>
</h2>
<p>The <code>simulate</code> function has several relatively intuitive
settings:</p>
<ul>
<li><p><code>nsim</code>: the number of replicate simulations to run.
The default is 1. Increasing this value makes sense if including any
form of variation, such as demographic or environmental stochasticity or
multiple initial conditions. Replicate simulations are vectorised, so
including replicates will (in most cases) be substantially faster than
multiple simulations with <code>nsim = 1</code>.</p></li>
<li><p><code>seed</code>: the random seed used to initialise any random
draws. Defaults to <code>NULL</code>, in which case the seed from the
current workspace is used. Set this value if reproducible results are
required.</p></li>
<li><p><code>options</code>: these are the basic settings that control
how <code>simulate</code> works. Several more-complex settings are
described in <a href="#updaters">Updaters</a> and <a href="#initials">Initial conditions</a>, below.</p></li>
<li><p><code>ntime</code>: number of time steps to simulate. Defaults to
50 and is ignored if covariates are included in a model because
covariates determine the number of time steps.</p></li>
<li><p><code>keep_slices</code>: should <code>simulate</code> return
every intermediate time step? Defaults to <code>TRUE</code>, set to
<code>FALSE</code> if only the final time step is required. This will
reduce memory use, which is helpful for large models.</p></li>
<li><p><code>tidy_abundances</code>: what happens to abundance estimates
after each iteration? Defaults to <code>identity</code>, which means
that abundances are left unchanged, potentially as decimal values. A
good alternative is <code>floor</code>, which will round down to the
nearest integer, implying that fractional individuals cannot exist. Can
be replaced with any function that takes in a vector and returns a
vector of the the same size (e.g., <code>ceiling</code>,
<code>round</code>).</p></li>
</ul>
<p>All of the above settings can be changed directly in a call to
<code>simulate</code>. <code>options</code> is a named list, so a
modified call to <code>simulate</code> might look like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">popdyn</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">30</span>, keep_slices <span class="op">=</span> <span class="cn">FALSE</span>, tidy_abundances <span class="op">=</span> <span class="va">floor</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, if certain settings need to be updated for all
simulations in a project, it might be easier to change these at a deeper
level through the global <code>options</code> in R. Specifically,
<code>ntime</code>, <code>keep_slices</code>, and
<code>tidy_abundances</code> are all set as options and can be updated
with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ntime</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>aae.pop_ntime <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keep_slices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>aae.pop_keep_slices <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tidy_abundances</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>aae.pop_tidy_abundances <span class="op">=</span> <span class="va">floor</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initials">Initial conditions<a class="anchor" aria-label="anchor" href="#initials"></a>
</h2>
<p>Setting initial conditions is a really important part of population
dynamics modelling. The default initial conditions in
<code>aae.pop</code> are random Poisson draws with a mean of 10. This is
very simplistic, and assumes that a model will be run for many
generations and that transient dynamics are not of interest.</p>
<p>The default initial conditions can be changed in several ways. First,
the mean of the Poisson distribution can be changed by setting
<code>initialise_args</code> in the <code>options</code> argument to
<code>simulate</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">popdyn</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initialise_args <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, this value can be changed for all simulations in an R
session with the <code>options</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>aae.pop_lambda <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>At a slightly deeper level, if a Poisson distribution is
inappropriate, this can be changed to any other function through the
<code>options</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define your own initialisation function</span></span>
<span><span class="va">my_initials_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">other_arguments</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">simulate_n_values_somehow</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, <span class="va">other_arguments</span><span class="op">)</span>  <span class="co"># e.g. rnbinom, rlnorm, ...</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># this neeeds wrapping up so aae.pop can use it</span></span>
<span><span class="va">initials_function_wrapper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">args</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">my_initials_function</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="va">args</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># set this at the global level (i.e. for an entire R session)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>aae.pop_initialisation <span class="op">=</span> <span class="va">initials_function_wrapper</span><span class="op">)</span></span></code></pre></div>
<p>The form of the wrapper function is restricted and must include two
arguments: <code>n</code>, an integer, and <code>args</code>, a list of
other arguments passed to simulate through the
<code>initialise_args</code> element of the <code>options</code>
argument. The initialisation function itself is less restricted but the
first argument must be an integer specifying the number of values to
simulate. This function cannot include structure in abundances, such as
differences among age classes or replicates.</p>
<p>More complex initial conditions can be passed to
<code>simulate</code> with the <code>init</code> argument. Initial
conditions can be specified as a vector with one element per population
class or as a matrix (or array) with one row per replicate and one
column per population class. If specified as a vector and
<code>nsim</code> is greater than 1, the initial conditions are assumed
to be the same in all replicates. This approach allows initial
conditions with any amount of structure or detail:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># need a matrix/array with one row per replicate and one column</span></span>
<span><span class="co">#    per class (5 age classes in this example)</span></span>
<span><span class="va">my_initials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">25</span>, <span class="fl">15</span>, <span class="fl">5</span>,   <span class="co"># first replicate</span></span>
<span>    <span class="fl">200</span>, <span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">30</span>, <span class="fl">10</span>, <span class="co"># second replicate</span></span>
<span>    <span class="fl">50</span>, <span class="fl">25</span>, <span class="fl">12</span>, <span class="fl">8</span>, <span class="fl">2</span>      <span class="co"># third replicate</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span>,    <span class="co"># will set 3 replicates in simulate</span></span>
<span>  ncol <span class="op">=</span> <span class="fl">5</span>,    <span class="co"># and 5 age classes</span></span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># this just makes formatting easier</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate with these values</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">popdyn</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  init <span class="op">=</span> <span class="va">my_initials</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tidy_abundances <span class="op">=</span> <span class="va">floor</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot this</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sims</span>,</span>
<span>  col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"#2171B5"</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Three different initial conditions"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="beyond_defaults_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="700"></p>
<p>The previous example might be a bit unwieldy with many replicates, in
which case a single vector can be passed to simulate:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># need a vector with one value per class (5 age classes, here)</span></span>
<span><span class="va">my_initials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">25</span>, <span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate with these values</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">popdyn</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  init <span class="op">=</span> <span class="va">my_initials</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tidy_abundances <span class="op">=</span> <span class="va">floor</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot this</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sims</span>,</span>
<span>  col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"#2171B5"</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Many replicates with the same initial condition"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="beyond_defaults_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<p>Alternatively, this approach could be modified to add stochasticity
to initial conditions while retaining some of the structure from the
previous examples:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate a matrix with one row per replicate and one column</span></span>
<span><span class="co">#   per class (5 classes, 100 replicates), setting a different </span></span>
<span><span class="co">#   mean (lambda) in each column</span></span>
<span><span class="va">my_initials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">*</span> <span class="fl">100</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">25</span>, <span class="fl">15</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate with these values</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>  <span class="va">popdyn</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  init <span class="op">=</span> <span class="va">my_initials</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tidy_abundances <span class="op">=</span> <span class="va">floor</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot this</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sims</span>,</span>
<span>  col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"#2171B5"</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Many replicates with stochastic, structured initial conditions"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="beyond_defaults_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level2">
<h2 id="updaters">Updaters<a class="anchor" aria-label="anchor" href="#updaters"></a>
</h2>
<p>The update step is where abundances get updated from one time step to
the next (e.g., one generation). This process is typically the slowest
part of simulating population dynamics, at least in realistically
complex models.</p>
<div class="section level3">
<h3 id="built-in-updaters">Built-in updaters<a class="anchor" aria-label="anchor" href="#built-in-updaters"></a>
</h3>
<p>The default updater in <code>aae.pop</code> is R’s built-in cross
product. This method is extremely fast and is vectorised, so handles
replicates easily. There are two catches:</p>
<ul>
<li>the vectorisation will not be as efficient when there is variation
in vital rates among replicates (a common situation).</li>
<li>this approach doesn’t handle some fairly common forms of demographic
stochasticity, such as drawing abundances from a Binomial
distribution.</li>
</ul>
<p>The cross product approach is still recommended in most cases, and
outperforms most R-based alternatives, including C++ tools written
specifically for matrix operations.</p>
<p>The updater can be changed at a global level through the
<code>options</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change updater</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>aae.pop_update <span class="op">=</span> <span class="va">update_my_way</span><span class="op">)</span></span></code></pre></div>
<p>The <code>aae.pop</code> package includes two alternatives, which
incorporate demographic stochasticity using Binomial draws
(<code>update_binomial_leslie</code>, for Leslie matrices) or
multinomial draws (<code>update_multinomial</code>, for all other
matrices). These approaches are not as fast as the default cross product
method. The <code>update_binomial_leslie</code> method is demonstrated
in the <a href="macperch_example.html">Macquarie perch example
model</a>.</p>
</div>
<div class="section level3">
<h3 id="roll-your-own-updater">Roll your own updater<a class="anchor" aria-label="anchor" href="#roll-your-own-updater"></a>
</h3>
<p>Although not trivial, it is relatively easy to define an updater
using a bespoke method. The updater function simply needs two input
arguments, a matrix of replicate population vectors and a population
matrix, and needs to return an updated matrix of replicate population
vectors. The population vectors are always provided as a matrix with
replicates in rows and classes in columns, and the population matrix
will always be a square matrix with one row/column for each class.</p>
<p>Looking inside the built-in updaters will give some insight into the
structure of <code>aae.pop</code> updaters.
<code>update_crossprod</code> simply uses R’s <code>tcrossprod</code>
function to handle the matrix of replicate population vectors:</p>
<pre><code><span><span class="co">## function (pop, mat) </span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     tcrossprod(pop, mat)</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## &lt;bytecode: 0x55d134c57e48&gt;</span></span>
<span><span class="co">## &lt;environment: namespace:aae.pop&gt;</span></span></code></pre>
<p>The <code>update_binomial_leslie</code> function is slightly more
complicated and includes a check for integer abundances and then uses a
mix of Poisson (for reproduction) and Binomial draws (for survival):</p>
<pre><code><span><span class="co">## function (pop, mat) </span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     if (!all((pop%%1) == 0)) {</span></span>
<span><span class="co">##         stop("some abundances are not integers, so cannot be used ", </span></span>
<span><span class="co">##             "with update_binomial_leslie. ", "Check options()$aae.pop_tidy_abundances ", </span></span>
<span><span class="co">##             "and update with an appropriate method (e.g. floor)", </span></span>
<span><span class="co">##             call. = FALSE)</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     if (is.null(dim(pop))) {</span></span>
<span><span class="co">##         pop &lt;- matrix(pop, nrow = 1)</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     pop_nm1 &lt;- pop[, -ncol(pop), drop = FALSE]</span></span>
<span><span class="co">##     vals &lt;- tcrossprod(pop, mat)</span></span>
<span><span class="co">##     probs &lt;- vals[, -1]/pop_nm1</span></span>
<span><span class="co">##     probs[pop_nm1 == 0] &lt;- 0</span></span>
<span><span class="co">##     cbind(rpois(nrow(vals), lambda = vals[, 1]), matrix(rbinom(length(probs), </span></span>
<span><span class="co">##         size = pop_nm1, prob = probs), nrow = nrow(pop_nm1)))</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## &lt;bytecode: 0x55d135619d28&gt;</span></span>
<span><span class="co">## &lt;environment: namespace:aae.pop&gt;</span></span></code></pre>
<p>The primary reason to change the updater is speed. Although
<code>update_crossprod</code> is relatively fast compared to other R
methods, it is highly likely that other methods can be sped up through,
for example, the use of C++ matrix libraries (e.g., with
<code>RcppEigen</code> and <code>RcppArmadillo</code>). The final
updater to use is best determined through benchmarking of alternative
updaters. Keep in mind that <code>aae.pop</code> is built for
flexibility and R compatibility rather then speed <em>per se</em>. If
speed is the primary limitation or concern, a better approach might
involve coding the entire simulation process in C++ or similar.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jian Yen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
