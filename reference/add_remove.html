<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Specify additions or removals in models of population dynamics — add_remove • aae.pop</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specify additions or removals in models of population dynamics — add_remove"><meta name="description" content="Specify additions or removals from the population vector
  that occur before (add_remove_pre) or after the update step
  (add_remove_post)."><meta property="og:description" content="Specify additions or removals from the population vector
  that occur before (add_remove_pre) or after the update step
  (add_remove_post)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aae.pop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1.9007</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/get_started.html">get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/including_processes.html">Including processes</a></li>
    <li><a class="dropdown-item" href="../articles/beyond_defaults.html">Beyond defaults</a></li>
    <li><a class="dropdown-item" href="../articles/metapopulations.html">Metapopulations</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_species.html">Multiple species</a></li>
    <li><a class="dropdown-item" href="../articles/templates.html">Species templates</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples"><li><a class="dropdown-item" href="../articles/macperch_example.html">Macquarie perch</a></li>
    <li><a class="dropdown-item" href="../articles/scenarios_example.html">Comparing scenarios</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/aae-stats/aae.pop"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Specify additions or removals in models of population dynamics</h1>
      <small class="dont-index">Source: <a href="https://github.com/aae-stats/aae.pop/blob/main/R/add_remove.R" class="external-link"><code>R/add_remove.R</code></a></small>
      <div class="d-none name"><code>add_remove.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Specify additions or removals from the population vector
  that occur before (<code>add_remove_pre</code>) or after the update step
  (<code>add_remove_post</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_remove_pre</span><span class="op">(</span><span class="va">masks</span>, <span class="va">funs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_remove_post</span><span class="op">(</span><span class="va">masks</span>, <span class="va">funs</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-masks">masks<a class="anchor" aria-label="anchor" href="#arg-masks"></a></dt>
<dd><p>a logical matrix or vector (or list of these)
defining cells affected by <code>funs</code>. See Details and
<code><a href="masks.html">masks</a></code></p></dd>


<dt id="arg-funs">funs<a class="anchor" aria-label="anchor" href="#arg-funs"></a></dt>
<dd><p>a function or list of functions with one element
for each element of <code>masks</code>. See Details</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>add_remove_pre</code> specifies a function that
  operates on the population vector prior to the population
  update step. Examples might include fatalities (recorded
  in absolute numbers), removals, or additions to the
  population that occur prior to the update (shifting
  from one generation to the next).</p>
<p><code>add_remove_post</code> is the same as <code>add_remove_pre</code>
  but operates on the population vector after the population
  update step.</p>
<p><code>masks</code> are logical vectors with one element for
  each class. Additional details on masks are provided
  in <code><a href="masks.html">masks</a></code>.</p>
<p><code>funs</code> takes only one argument, the population
  abundances <code>n</code> prior (<code>add_remove_pre</code>) or
  following (<code>add_remove_post</code>) all other updates in a
  given iteration/generation. This allows direct additions
  or removals to the population vector, potentially based
  on external arguments (e.g., mass mortality events or
  harvesting).</p>
<p>Additional arguments to functions are supported and can be
  passed to <code><a href="simulate.html">simulate</a></code> with the <code>args</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># define a population matrix (columns move to rows)</span></span></span>
<span class="r-in"><span><span class="va">nclass</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">popmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">nclass</span>, ncol <span class="op">=</span> <span class="va">nclass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popmat</span><span class="op">[</span><span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popmat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.65</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define a dynamics object</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="dynamics.html">dynamics</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># remove up to 10 individuals from stages 4 and 5 prior to the</span></span></span>
<span class="r-in"><span><span class="co">#   matrix update</span></span></span>
<span class="r-in"><span><span class="va">removals</span> <span class="op">&lt;-</span> <span class="fu">add_remove_pre</span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="masks.html">all_classes</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="va">x</span> <span class="op">-</span> <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">removals</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate trajectories</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate.html">simulate</a></span><span class="op">(</span><span class="va">dyn</span>, nsim <span class="op">=</span> <span class="fl">100</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_remove-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># remove up to 10 individuals from stages 4 and 5 after to the</span></span></span>
<span class="r-in"><span><span class="co">#   matrix update</span></span></span>
<span class="r-in"><span><span class="va">removals</span> <span class="op">&lt;-</span> <span class="fu">add_remove_post</span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="masks.html">all_classes</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="va">x</span> <span class="op">-</span> <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object (can't update because that will</span></span></span>
<span class="r-in"><span><span class="co">#   include the add_remove_pre as well)</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="dynamics.html">dynamics</a></span><span class="op">(</span><span class="va">popmat</span>, <span class="va">removals</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate trajectories</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate.html">simulate</a></span><span class="op">(</span><span class="va">dyn</span>, nsim <span class="op">=</span> <span class="fl">100</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="add_remove-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jian Yen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

