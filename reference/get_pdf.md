# Calculate the probability density of a summary statistic across all iterations of a [`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md) object

Calculate the probability density of a summary statistic across all
iterations of a
[`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md)
object

## Usage

``` r
get_pdf(sims, subset = NULL, times = NULL, n = 100, fn = min, ...)
```

## Arguments

- sims:

  an object returned from
  [`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md)

- subset:

  `integer` vector denoting the population classes to include in
  calculation of population abundance. Defaults to all classes

- times:

  `integer` vector specifying generations to include in calculation of
  extinction risk. Defaults to all simulated generations

- n:

  `integer` specifying number of threshold values to use in default case
  when `threshold` is not specified. Defaults to 100

- fn:

  function to apply to each iteration. Defaults to min

- ...:

  additional arguments passed to `fn`

## Details

`get_pdf` and `get_cdf` are faster and more general alternatives to the
`risk_curve` function. `get_pdf` can be used to calculate the
probability distribution of any summary statistic. For example, the
probability distribution of the minimum population size is the
density-based equivalent of a risk curve (the function `get_cdf` can be
used to get the true equivalent). Summary statistics for `get_pdf` are
extracted from a
[`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md)
object and represent the distribution of that statistic over all
replicate trajectories at any time step within a set period. Abundances
can be specified for all population classes or for a subset of classes.

## Examples

``` r
# define a basic population
nstage <- 5
popmat <- matrix(0, nrow = nstage, ncol = nstage)
popmat[reproduction(popmat, dims = 4:5)] <- c(10, 20)
popmat[transition(popmat)] <- c(0.25, 0.3, 0.5, 0.65)

# define a dynamics object
dyn <- dynamics(popmat)

# simulate with the default updater
sims <- simulate(dyn, nsim = 1000)

# calculate distribution of minimum population sizes (default)
get_pdf(sims)
#>             prob    value
#> 1   3.264137e-06 12.70911
#> 2   9.001375e-06 13.20475
#> 3   2.202154e-05 13.70040
#> 4   4.740511e-05 14.19605
#> 5   9.028367e-05 14.69170
#> 6   1.532304e-04 15.18735
#> 7   2.343019e-04 15.68300
#> 8   3.278509e-04 16.17865
#> 9   4.294706e-04 16.67430
#> 10  5.420496e-04 17.16995
#> 11  6.785574e-04 17.66559
#> 12  8.622771e-04 18.16124
#> 13  1.124365e-03 18.65689
#> 14  1.501874e-03 19.15254
#> 15  2.029323e-03 19.64819
#> 16  2.720779e-03 20.14384
#> 17  3.552635e-03 20.63949
#> 18  4.464269e-03 21.13514
#> 19  5.397258e-03 21.63079
#> 20  6.338670e-03 22.12643
#> 21  7.344503e-03 22.62208
#> 22  8.518296e-03 23.11773
#> 23  9.953700e-03 23.61338
#> 24  1.168716e-02 24.10903
#> 25  1.368408e-02 24.60468
#> 26  1.586742e-02 25.10033
#> 27  1.816158e-02 25.59598
#> 28  2.053944e-02 26.09163
#> 29  2.303282e-02 26.58727
#> 30  2.571931e-02 27.08292
#> 31  2.868862e-02 27.57857
#> 32  3.198932e-02 28.07422
#> 33  3.559107e-02 28.56987
#> 34  3.936090e-02 29.06552
#> 35  4.307421e-02 29.56117
#> 36  4.646305e-02 30.05682
#> 37  4.929217e-02 30.55247
#> 38  5.143296e-02 31.04812
#> 39  5.292621e-02 31.54376
#> 40  5.398473e-02 32.03941
#> 41  5.491140e-02 32.53506
#> 42  5.592228e-02 33.03071
#> 43  5.703852e-02 33.52636
#> 44  5.810187e-02 34.02201
#> 45  5.892168e-02 34.51766
#> 46  5.944802e-02 35.01331
#> 47  5.981067e-02 35.50896
#> 48  6.020471e-02 36.00460
#> 49  6.070466e-02 36.50025
#> 50  6.114885e-02 36.99590
#> 51  6.121135e-02 37.49155
#> 52  6.059078e-02 37.98720
#> 53  5.917433e-02 38.48285
#> 54  5.706576e-02 38.97850
#> 55  5.448742e-02 39.47415
#> 56  5.161963e-02 39.96980
#> 57  4.855122e-02 40.46544
#> 58  4.531337e-02 40.96109
#> 59  4.194785e-02 41.45674
#> 60  3.853551e-02 41.95239
#> 61  3.518029e-02 42.44804
#> 62  3.198431e-02 42.94369
#> 63  2.903759e-02 43.43934
#> 64  2.639723e-02 43.93499
#> 65  2.406947e-02 44.43064
#> 66  2.197965e-02 44.92628
#> 67  1.997586e-02 45.42193
#> 68  1.788827e-02 45.91758
#> 69  1.562848e-02 46.41323
#> 70  1.324624e-02 46.90888
#> 71  1.090666e-02 47.40453
#> 72  8.804312e-03 47.90018
#> 73  7.061287e-03 48.39583
#> 74  5.689527e-03 48.89148
#> 75  4.623155e-03 49.38712
#> 76  3.776560e-03 49.88277
#> 77  3.089175e-03 50.37842
#> 78  2.529862e-03 50.87407
#> 79  2.083682e-03 51.36972
#> 80  1.730643e-03 51.86537
#> 81  1.441978e-03 52.36102
#> 82  1.189914e-03 52.85667
#> 83  9.616327e-04 53.35232
#> 84  7.633415e-04 53.84796
#> 85  6.117176e-04 54.34361
#> 86  5.203364e-04 54.83926
#> 87  4.865326e-04 55.33491
#> 88  4.916784e-04 55.83056
#> 89  5.085196e-04 56.32621
#> 90  5.114190e-04 56.82186
#> 91  4.841713e-04 57.31751
#> 92  4.241109e-04 57.81316
#> 93  3.398325e-04 58.30880
#> 94  2.468201e-04 58.80445
#> 95  1.613002e-04 59.30010
#> 96  9.432103e-05 59.79575
#> 97  4.906976e-05 60.29140
#> 98  2.260032e-05 60.78705
#> 99  9.172719e-06 61.28270
#> 100 3.308518e-06 61.77835

# calculate distribution of maximum population sizes
get_pdf(sims, fn = max)
#>             prob     value
#> 1   2.709603e-07  65.52037
#> 2   7.860361e-07  71.79395
#> 3   1.979493e-06  78.06752
#> 4   4.323158e-06  84.34110
#> 5   8.238082e-06  90.61468
#> 6   1.383870e-05  96.88826
#> 7   2.081313e-05 103.16184
#> 8   2.897022e-05 109.43542
#> 9   3.931342e-05 115.70899
#> 10  5.503441e-05 121.98257
#> 11  8.101942e-05 128.25615
#> 12  1.217951e-04 134.52973
#> 13  1.790430e-04 140.80331
#> 14  2.506061e-04 147.07689
#> 15  3.317803e-04 153.35047
#> 16  4.197545e-04 159.62404
#> 17  5.170278e-04 165.89762
#> 18  6.326227e-04 172.17120
#> 19  7.788553e-04 178.44478
#> 20  9.665546e-04 184.71836
#> 21  1.199255e-03 190.99194
#> 22  1.469454e-03 197.26551
#> 23  1.758378e-03 203.53909
#> 24  2.045911e-03 209.81267
#> 25  2.320746e-03 216.08625
#> 26  2.586672e-03 222.35983
#> 27  2.859602e-03 228.63341
#> 28  3.155493e-03 234.90699
#> 29  3.478334e-03 241.18056
#> 30  3.813562e-03 247.45414
#> 31  4.132283e-03 253.72772
#> 32  4.406556e-03 260.00130
#> 33  4.624153e-03 266.27488
#> 34  4.793945e-03 272.54846
#> 35  4.937747e-03 278.82203
#> 36  5.072868e-03 285.09561
#> 37  5.203573e-03 291.36919
#> 38  5.321607e-03 297.64277
#> 39  5.412045e-03 303.91635
#> 40  5.457662e-03 310.18993
#> 41  5.443089e-03 316.46350
#> 42  5.361405e-03 322.73708
#> 43  5.219719e-03 329.01066
#> 44  5.033833e-03 335.28424
#> 45  4.819151e-03 341.55782
#> 46  4.583680e-03 347.83140
#> 47  4.329750e-03 354.10498
#> 48  4.061469e-03 360.37855
#> 49  3.790267e-03 366.65213
#> 50  3.533089e-03 372.92571
#> 51  3.304489e-03 379.19929
#> 52  3.110246e-03 385.47287
#> 53  2.945146e-03 391.74645
#> 54  2.794238e-03 398.02002
#> 55  2.638054e-03 404.29360
#> 56  2.458814e-03 410.56718
#> 57  2.246690e-03 416.84076
#> 58  2.006252e-03 423.11434
#> 59  1.756422e-03 429.38792
#> 60  1.523037e-03 435.66150
#> 61  1.327515e-03 441.93507
#> 62  1.175297e-03 448.20865
#> 63  1.054934e-03 454.48223
#> 64  9.471877e-04 460.75581
#> 65  8.369609e-04 467.02939
#> 66  7.210441e-04 473.30297
#> 67  6.063468e-04 479.57654
#> 68  5.023069e-04 485.85012
#> 69  4.148429e-04 492.12370
#> 70  3.444906e-04 498.39728
#> 71  2.895479e-04 504.67086
#> 72  2.484222e-04 510.94444
#> 73  2.194418e-04 517.21801
#> 74  1.988137e-04 523.49159
#> 75  1.810824e-04 529.76517
#> 76  1.613627e-04 536.03875
#> 77  1.378841e-04 542.31233
#> 78  1.125154e-04 548.58591
#> 79  8.839361e-05 554.85949
#> 80  6.759910e-05 561.13306
#> 81  5.045750e-05 567.40664
#> 82  3.625558e-05 573.68022
#> 83  2.453059e-05 579.95380
#> 84  1.536975e-05 586.22738
#> 85  9.116798e-06 592.50096
#> 86  5.890208e-06 598.77453
#> 87  5.602592e-06 605.04811
#> 88  7.974190e-06 611.32169
#> 89  1.240574e-05 617.59527
#> 90  1.769218e-05 623.86885
#> 91  2.213640e-05 630.14243
#> 92  2.406507e-05 636.41601
#> 93  2.266083e-05 642.68958
#> 94  1.850451e-05 648.96316
#> 95  1.309609e-05 655.23674
#> 96  8.027971e-06 661.51032
#> 97  4.270385e-06 667.78390
#> 98  1.967927e-06 674.05748
#> 99  7.838395e-07 680.33105
#> 100 2.705953e-07 686.60463

# calculate distribution of the 90th percentile of
#   population sizes
get_pdf(sims, fn = quantile, prob = 0.9)
#>             prob     value
#> 1   6.358969e-07  51.98291
#> 2   1.797093e-06  54.58009
#> 3   4.437688e-06  57.17727
#> 4   9.567160e-06  59.77446
#> 5   1.807589e-05  62.37164
#> 6   3.008504e-05  64.96882
#> 7   4.439314e-05  67.56600
#> 8   5.886158e-05  70.16318
#> 9   7.196569e-05  72.76036
#> 10  8.462415e-05  75.35755
#> 11  1.013063e-04  77.95473
#> 12  1.292303e-04  80.55191
#> 13  1.765041e-04  83.14909
#> 14  2.498979e-04  85.74627
#> 15  3.531715e-04  88.34345
#> 16  4.850169e-04  90.94063
#> 17  6.409783e-04  93.53782
#> 18  8.170253e-04  96.13500
#> 19  1.014394e-03  98.73218
#> 20  1.241566e-03 101.32936
#> 21  1.510520e-03 103.92654
#> 22  1.828681e-03 106.52372
#> 23  2.192014e-03 109.12091
#> 24  2.586332e-03 111.71809
#> 25  2.999260e-03 114.31527
#> 26  3.435368e-03 116.91245
#> 27  3.920336e-03 119.50963
#> 28  4.491480e-03 122.10681
#> 29  5.172036e-03 124.70399
#> 30  5.955593e-03 127.30118
#> 31  6.802933e-03 129.89836
#> 32  7.657386e-03 132.49554
#> 33  8.468519e-03 135.09272
#> 34  9.206258e-03 137.68990
#> 35  9.853360e-03 140.28708
#> 36  1.039034e-02 142.88427
#> 37  1.079559e-02 145.48145
#> 38  1.106656e-02 148.07863
#> 39  1.124013e-02 150.67581
#> 40  1.139172e-02 153.27299
#> 41  1.160175e-02 155.87017
#> 42  1.190403e-02 158.46736
#> 43  1.226102e-02 161.06454
#> 44  1.257859e-02 163.66172
#> 45  1.275137e-02 166.25890
#> 46  1.272235e-02 168.85608
#> 47  1.250309e-02 171.45326
#> 48  1.215693e-02 174.05044
#> 49  1.175692e-02 176.64763
#> 50  1.134580e-02 179.24481
#> 51  1.091931e-02 181.84199
#> 52  1.044209e-02 184.43917
#> 53  9.879713e-03 187.03635
#> 54  9.229790e-03 189.63353
#> 55  8.532888e-03 192.23072
#> 56  7.853350e-03 194.82790
#> 57  7.248374e-03 197.42508
#> 58  6.741427e-03 200.02226
#> 59  6.311820e-03 202.61944
#> 60  5.914748e-03 205.21662
#> 61  5.504496e-03 207.81380
#> 62  5.050875e-03 210.41099
#> 63  4.544944e-03 213.00817
#> 64  3.994440e-03 215.60535
#> 65  3.420765e-03 218.20253
#> 66  2.858200e-03 220.79971
#> 67  2.348919e-03 223.39689
#> 68  1.929778e-03 225.99408
#> 69  1.619593e-03 228.59126
#> 70  1.412759e-03 231.18844
#> 71  1.283501e-03 233.78562
#> 72  1.197816e-03 236.38280
#> 73  1.127388e-03 238.97998
#> 74  1.053443e-03 241.57717
#> 75  9.661394e-04 244.17435
#> 76  8.637953e-04 246.77153
#> 77  7.511819e-04 249.36871
#> 78  6.373959e-04 251.96589
#> 79  5.322311e-04 254.56307
#> 80  4.423987e-04 257.16025
#> 81  3.702320e-04 259.75744
#> 82  3.144709e-04 262.35462
#> 83  2.714517e-04 264.95180
#> 84  2.362625e-04 267.54898
#> 85  2.045042e-04 270.14616
#> 86  1.739609e-04 272.74334
#> 87  1.450780e-04 275.34053
#> 88  1.201222e-04 277.93771
#> 89  1.010828e-04 280.53489
#> 90  8.799626e-05 283.13207
#> 91  7.852021e-05 285.72925
#> 92  6.919693e-05 288.32643
#> 93  5.763951e-05 290.92361
#> 94  4.388357e-05 293.52080
#> 95  2.989064e-05 296.11798
#> 96  1.800916e-05 298.71516
#> 97  9.546845e-06 301.31234
#> 98  4.432284e-06 303.90952
#> 99  1.795847e-06 306.50670
#> 100 6.356467e-07 309.10389

# calculate distribution of minimum population sizes
#   but ignore first 10 years
get_pdf(sims, fn = max, times = 11:51)
#>             prob     value
#> 1   5.197521e-07  50.59885
#> 2   1.398449e-06  53.64318
#> 3   3.343174e-06  56.68751
#> 4   7.087713e-06  59.73184
#> 5   1.333183e-05  62.77618
#> 6   2.237407e-05  65.82051
#> 7   3.379705e-05  68.86484
#> 8   4.661753e-05  71.90917
#> 9   6.005793e-05  74.95351
#> 10  7.459670e-05  77.99784
#> 11  9.242055e-05  81.04217
#> 12  1.169814e-04  84.08651
#> 13  1.523391e-04  87.13084
#> 14  2.030769e-04  90.17517
#> 15  2.749182e-04  93.21950
#> 16  3.750830e-04  96.26384
#> 17  5.100005e-04  99.30817
#> 18  6.808885e-04 102.35250
#> 19  8.792830e-04 105.39683
#> 20  1.087831e-03 108.44117
#> 21  1.288602e-03 111.48550
#> 22  1.474184e-03 114.52983
#> 23  1.655762e-03 117.57416
#> 24  1.861991e-03 120.61850
#> 25  2.126029e-03 123.66283
#> 26  2.469755e-03 126.70716
#> 27  2.893009e-03 129.75150
#> 28  3.374409e-03 132.79583
#> 29  3.882911e-03 135.84016
#> 30  4.394081e-03 138.88449
#> 31  4.900389e-03 141.92883
#> 32  5.409091e-03 144.97316
#> 33  5.932060e-03 148.01749
#> 34  6.473627e-03 151.06182
#> 35  7.022262e-03 154.10616
#> 36  7.551743e-03 157.15049
#> 37  8.030221e-03 160.19482
#> 38  8.434335e-03 163.23916
#> 39  8.760303e-03 166.28349
#> 40  9.026310e-03 169.32782
#> 41  9.259083e-03 172.37215
#> 42  9.480379e-03 175.41649
#> 43  9.697299e-03 178.46082
#> 44  9.899215e-03 181.50515
#> 45  1.006136e-02 184.54948
#> 46  1.015357e-02 187.59382
#> 47  1.015427e-02 190.63815
#> 48  1.006447e-02 193.68248
#> 49  9.910701e-03 196.72682
#> 50  9.731570e-03 199.77115
#> 51  9.549576e-03 202.81548
#> 52  9.356197e-03 205.85981
#> 53  9.118772e-03 208.90415
#> 54  8.803620e-03 211.94848
#> 55  8.400826e-03 214.99281
#> 56  7.925082e-03 218.03714
#> 57  7.403996e-03 221.08148
#> 58  6.864935e-03 224.12581
#> 59  6.330895e-03 227.17014
#> 60  5.822515e-03 230.21448
#> 61  5.358040e-03 233.25881
#> 62  4.946602e-03 236.30314
#> 63  4.579407e-03 239.34747
#> 64  4.228865e-03 242.39181
#> 65  3.860849e-03 245.43614
#> 66  3.454816e-03 248.48047
#> 67  3.015337e-03 251.52480
#> 68  2.569588e-03 254.56914
#> 69  2.154604e-03 257.61347
#> 70  1.801688e-03 260.65780
#> 71  1.527655e-03 263.70214
#> 72  1.332793e-03 266.74647
#> 73  1.202434e-03 269.79080
#> 74  1.112028e-03 272.83513
#> 75  1.034283e-03 275.87947
#> 76  9.488429e-04 278.92380
#> 77  8.471882e-04 281.96813
#> 78  7.325602e-04 285.01246
#> 79  6.157209e-04 288.05680
#> 80  5.090381e-04 291.10113
#> 81  4.213891e-04 294.14546
#> 82  3.561722e-04 297.18979
#> 83  3.115722e-04 300.23413
#> 84  2.824362e-04 303.27846
#> 85  2.623199e-04 306.32279
#> 86  2.455970e-04 309.36713
#> 87  2.283046e-04 312.41146
#> 88  2.081533e-04 315.45579
#> 89  1.842768e-04 318.50012
#> 90  1.570448e-04 321.54446
#> 91  1.277691e-04 324.58879
#> 92  9.834925e-05 327.63312
#> 93  7.092134e-05 330.67745
#> 94  4.744094e-05 333.72179
#> 95  2.916753e-05 336.76612
#> 96  1.632906e-05 339.81045
#> 97  8.258409e-06 342.85479
#> 98  3.747322e-06 345.89912
#> 99  1.522318e-06 348.94345
#> 100 5.536356e-07 351.98778
```
