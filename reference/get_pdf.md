# Calculate the probability density of a summary statistic across all iterations of a [`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md) object

Calculate the probability density of a summary statistic across all
iterations of a
[`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md)
object

## Usage

``` r
get_pdf(sims, subset = NULL, times = NULL, n = 100, fn = min, ...)
```

## Arguments

- sims:

  an object returned from
  [`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md)

- subset:

  `integer` vector denoting the population classes to include in
  calculation of population abundance. Defaults to all classes

- times:

  `integer` vector specifying generations to include in calculation of
  extinction risk. Defaults to all simulated generations

- n:

  `integer` specifying number of threshold values to use in default case
  when `threshold` is not specified. Defaults to 100

- fn:

  function to apply to each iteration. Defaults to min

- ...:

  additional arguments passed to `fn`

## Value

a data.frame containing a `prob` column that indicates the probability
density that abundances will be in the vicinity of the threshold value
in the `value` column

## Details

`get_pdf` and `get_cdf` are faster and more general alternatives to the
`risk_curve` function. `get_pdf` can be used to calculate the
probability distribution of any summary statistic. For example, the
probability distribution of the minimum population size is the
density-based equivalent of a risk curve (the function `get_cdf` can be
used to get the true equivalent). Summary statistics for `get_pdf` are
extracted from a
[`simulate`](https://aae-stats.github.io/aae.pop/reference/simulate.md)
object and represent the distribution of that statistic over all
replicate trajectories at any time step within a set period. Abundances
can be specified for all population classes or for a subset of classes.

## Examples

``` r
# define a basic population
nstage <- 5
popmat <- matrix(0, nrow = nstage, ncol = nstage)
popmat[reproduction(popmat, dims = 4:5)] <- c(10, 20)
popmat[transition(popmat)] <- c(0.25, 0.3, 0.5, 0.65)

# define a dynamics object
dyn <- dynamics(popmat)

# simulate with the default updater
sims <- simulate(dyn, nsim = 1000)

# calculate distribution of minimum population sizes (default)
get_pdf(sims)
#>             prob    value
#> 1   3.240007e-06 12.69176
#> 2   8.955087e-06 13.18776
#> 3   2.182391e-05 13.68376
#> 4   4.688103e-05 14.17976
#> 5   8.922445e-05 14.67576
#> 6   1.515009e-04 15.17176
#> 7   2.320442e-04 15.66775
#> 8   3.251992e-04 16.16375
#> 9   4.267327e-04 16.65975
#> 10  5.393383e-04 17.15575
#> 11  6.758139e-04 17.65175
#> 12  8.591638e-04 18.14775
#> 13  1.120100e-03 18.64375
#> 14  1.495614e-03 19.13975
#> 15  2.020424e-03 19.63575
#> 16  2.711010e-03 20.13175
#> 17  3.546512e-03 20.62775
#> 18  4.475699e-03 21.12375
#> 19  5.452390e-03 21.61975
#> 20  6.477319e-03 22.11575
#> 21  7.617109e-03 22.61175
#> 22  8.969425e-03 23.10774
#> 23  1.060198e-02 23.60374
#> 24  1.250380e-02 24.09974
#> 25  1.458417e-02 24.59574
#> 26  1.671881e-02 25.09174
#> 27  1.881810e-02 25.58774
#> 28  2.087408e-02 26.08374
#> 29  2.296599e-02 26.57974
#> 30  2.523640e-02 27.07574
#> 31  2.784019e-02 27.57174
#> 32  3.088030e-02 28.06774
#> 33  3.435840e-02 28.56374
#> 34  3.814941e-02 29.05974
#> 35  4.201835e-02 29.55574
#> 36  4.567569e-02 30.05174
#> 37  4.885831e-02 30.54774
#> 38  5.139728e-02 31.04373
#> 39  5.327011e-02 31.53973
#> 40  5.461029e-02 32.03573
#> 41  5.565148e-02 32.53173
#> 42  5.659113e-02 33.02773
#> 43  5.749847e-02 33.52373
#> 44  5.830843e-02 34.01973
#> 45  5.892166e-02 34.51573
#> 46  5.933133e-02 35.01173
#> 47  5.965453e-02 35.50773
#> 48  6.004045e-02 36.00373
#> 49  6.051938e-02 36.49973
#> 50  6.091524e-02 36.99573
#> 51  6.092167e-02 37.49173
#> 52  6.027214e-02 37.98773
#> 53  5.887756e-02 38.48372
#> 54  5.683454e-02 38.97972
#> 55  5.432993e-02 39.47572
#> 56  5.150186e-02 39.97172
#> 57  4.841460e-02 40.46772
#> 58  4.510608e-02 40.96372
#> 59  4.165218e-02 41.45972
#> 60  3.817701e-02 41.95572
#> 61  3.481629e-02 42.45172
#> 62  3.168166e-02 42.94772
#> 63  2.884928e-02 43.44372
#> 64  2.634665e-02 43.93972
#> 65  2.414469e-02 44.43572
#> 66  2.214140e-02 44.93172
#> 67  2.017454e-02 45.42772
#> 68  1.808189e-02 45.92371
#> 69  1.579466e-02 46.41971
#> 70  1.338249e-02 46.91571
#> 71  1.102408e-02 47.41171
#> 72  8.917680e-03 47.90771
#> 73  7.183771e-03 48.40371
#> 74  5.823279e-03 48.89971
#> 75  4.759141e-03 49.39571
#> 76  3.899598e-03 49.89171
#> 77  3.186176e-03 50.38771
#> 78  2.596237e-03 50.88371
#> 79  2.122389e-03 51.37971
#> 80  1.748987e-03 51.87571
#> 81  1.447631e-03 52.37171
#> 82  1.189415e-03 52.86771
#> 83  9.591326e-04 53.36371
#> 84  7.612502e-04 53.85970
#> 85  6.110312e-04 54.35570
#> 86  5.206261e-04 54.85170
#> 87  4.874162e-04 55.34770
#> 88  4.922827e-04 55.84370
#> 89  5.081908e-04 56.33970
#> 90  5.099932e-04 56.83570
#> 91  4.818448e-04 57.33170
#> 92  4.211933e-04 57.82770
#> 93  3.368892e-04 58.32370
#> 94  2.443657e-04 58.81970
#> 95  1.594872e-04 59.31570
#> 96  9.323814e-05 59.81170
#> 97  4.854606e-05 60.30770
#> 98  2.240754e-05 60.80370
#> 99  9.129717e-06 61.29969
#> 100 3.285163e-06 61.79569

# calculate distribution of maximum population sizes
get_pdf(sims, fn = max)
#>             prob     value
#> 1   2.699979e-07  65.43841
#> 2   7.839197e-07  71.71364
#> 3   1.971247e-06  77.98888
#> 4   4.302163e-06  84.26411
#> 5   8.197538e-06  90.53935
#> 6   1.378040e-05  96.81458
#> 7   2.073962e-05 103.08981
#> 8   2.889461e-05 109.36505
#> 9   3.924172e-05 115.64028
#> 10  5.497950e-05 121.91552
#> 11  8.097212e-05 128.19075
#> 12  1.218735e-04 134.46599
#> 13  1.796936e-04 140.74122
#> 14  2.529659e-04 147.01645
#> 15  3.378829e-04 153.29169
#> 16  4.326025e-04 159.56692
#> 17  5.398222e-04 165.84216
#> 18  6.670719e-04 172.11739
#> 19  8.228009e-04 178.39262
#> 20  1.012825e-03 184.66786
#> 21  1.236700e-03 190.94309
#> 22  1.486299e-03 197.21833
#> 23  1.747115e-03 203.49356
#> 24  2.005618e-03 209.76880
#> 25  2.256268e-03 216.04403
#> 26  2.505703e-03 222.31926
#> 27  2.769545e-03 228.59450
#> 28  3.062505e-03 234.86973
#> 29  3.387507e-03 241.14497
#> 30  3.728788e-03 247.42020
#> 31  4.055776e-03 253.69543
#> 32  4.339112e-03 259.97067
#> 33  4.566934e-03 266.24590
#> 34  4.750975e-03 272.52114
#> 35  4.915911e-03 278.79637
#> 36  5.079076e-03 285.07160
#> 37  5.240339e-03 291.34684
#> 38  5.384323e-03 297.62207
#> 39  5.490440e-03 303.89731
#> 40  5.540192e-03 310.17254
#> 41  5.521206e-03 316.44778
#> 42  5.431466e-03 322.72301
#> 43  5.281453e-03 328.99824
#> 44  5.087611e-03 335.27348
#> 45  4.864220e-03 341.54871
#> 46  4.618451e-03 347.82395
#> 47  4.353472e-03 354.09918
#> 48  4.075789e-03 360.37441
#> 49  3.799520e-03 366.64965
#> 50  3.542727e-03 372.92488
#> 51  3.318189e-03 379.20012
#> 52  3.127410e-03 385.47535
#> 53  2.960311e-03 391.75059
#> 54  2.799390e-03 398.02582
#> 55  2.626678e-03 404.30105
#> 56  2.429267e-03 410.57629
#> 57  2.203573e-03 416.85152
#> 58  1.958904e-03 423.12676
#> 59  1.715081e-03 429.40199
#> 60  1.494382e-03 435.67722
#> 61  1.311757e-03 441.95246
#> 62  1.166996e-03 448.22769
#> 63  1.046983e-03 454.50293
#> 64  9.350639e-04 460.77816
#> 65  8.205497e-04 467.05340
#> 66  7.033717e-04 473.32863
#> 67  5.909143e-04 479.60386
#> 68  4.912177e-04 485.87910
#> 69  4.084969e-04 492.15433
#> 70  3.425066e-04 498.42957
#> 71  2.917394e-04 504.70480
#> 72  2.552392e-04 510.98003
#> 73  2.316231e-04 517.25527
#> 74  2.165441e-04 523.53050
#> 75  2.031799e-04 529.80574
#> 76  1.852065e-04 536.08097
#> 77  1.601722e-04 542.35620
#> 78  1.305830e-04 548.63144
#> 79  1.010865e-04 554.90667
#> 80  7.530188e-05 561.18191
#> 81  5.449032e-05 567.45714
#> 82  3.806736e-05 573.73238
#> 83  2.522270e-05 580.00761
#> 84  1.559197e-05 586.28284
#> 85  9.186977e-06 592.55808
#> 86  5.930222e-06 598.83331
#> 87  5.651103e-06 605.10855
#> 88  8.032273e-06 611.38378
#> 89  1.246782e-05 617.65901
#> 90  1.773680e-05 623.93425
#> 91  2.214265e-05 630.20948
#> 92  2.403433e-05 636.48472
#> 93  2.259774e-05 642.75995
#> 94  1.843248e-05 649.03519
#> 95  1.303669e-05 655.31042
#> 96  7.987373e-06 661.58565
#> 97  4.249244e-06 667.86089
#> 98  1.959609e-06 674.13612
#> 99  7.816987e-07 680.41136
#> 100 2.696301e-07 686.68659

# calculate distribution of the 90th percentile of
#   population sizes
get_pdf(sims, fn = quantile, prob = 0.9)
#>             prob     value
#> 1   6.364840e-07  51.99927
#> 2   1.798338e-06  54.59612
#> 3   4.444537e-06  57.19297
#> 4   9.586587e-06  59.78982
#> 5   1.811601e-05  62.38668
#> 6   3.014698e-05  64.98353
#> 7   4.447657e-05  67.58038
#> 8   5.895059e-05  70.17723
#> 9   7.204251e-05  72.77408
#> 10  8.468136e-05  75.37093
#> 11  1.013703e-04  77.96778
#> 12  1.293861e-04  80.56463
#> 13  1.769570e-04  83.16148
#> 14  2.511254e-04  85.75834
#> 15  3.561991e-04  88.35519
#> 16  4.918968e-04  90.95204
#> 17  6.550043e-04  93.54889
#> 18  8.426681e-04  96.14574
#> 19  1.056496e-03  98.74259
#> 20  1.303852e-03 101.33944
#> 21  1.593829e-03 103.93629
#> 22  1.929902e-03 106.53314
#> 23  2.303999e-03 109.12999
#> 24  2.699239e-03 111.72685
#> 25  3.103094e-03 114.32370
#> 26  3.522460e-03 116.92055
#> 27  3.986423e-03 119.51740
#> 28  4.534427e-03 122.11425
#> 29  5.189236e-03 124.71110
#> 30  5.942061e-03 127.30795
#> 31  6.752571e-03 129.90480
#> 32  7.567178e-03 132.50165
#> 33  8.343757e-03 135.09851
#> 34  9.063535e-03 137.69536
#> 35  9.718893e-03 140.29221
#> 36  1.029288e-02 142.88906
#> 37  1.075546e-02 145.48591
#> 38  1.108775e-02 148.08276
#> 39  1.131038e-02 150.67961
#> 40  1.148995e-02 153.27646
#> 41  1.170745e-02 155.87331
#> 42  1.200276e-02 158.47016
#> 43  1.234298e-02 161.06702
#> 44  1.263517e-02 163.66387
#> 45  1.277406e-02 166.26072
#> 46  1.270567e-02 168.85757
#> 47  1.244820e-02 171.45442
#> 48  1.207188e-02 174.05127
#> 49  1.165280e-02 176.64812
#> 50  1.123163e-02 179.24497
#> 51  1.080022e-02 181.84182
#> 52  1.032131e-02 184.43868
#> 53  9.761378e-03 187.03553
#> 54  9.119485e-03 189.63238
#> 55  8.435472e-03 192.22923
#> 56  7.770837e-03 194.82608
#> 57  7.180020e-03 197.42293
#> 58  6.685672e-03 200.01978
#> 59  6.267885e-03 202.61663
#> 60  5.881955e-03 205.21348
#> 61  5.480961e-03 207.81033
#> 62  5.034167e-03 210.40719
#> 63  4.535293e-03 213.00404
#> 64  3.996963e-03 215.60089
#> 65  3.443851e-03 218.19774
#> 66  2.908285e-03 220.79459
#> 67  2.425030e-03 223.39144
#> 68  2.022412e-03 225.98829
#> 69  1.714291e-03 228.58514
#> 70  1.495920e-03 231.18199
#> 71  1.346933e-03 233.77884
#> 72  1.240207e-03 236.37570
#> 73  1.152320e-03 238.97255
#> 74  1.066418e-03 241.56940
#> 75  9.722410e-04 244.16625
#> 76  8.664738e-04 246.76310
#> 77  7.523578e-04 249.35995
#> 78  6.379623e-04 251.95680
#> 79  5.325600e-04 254.55365
#> 80  4.426137e-04 257.15050
#> 81  3.703854e-04 259.74736
#> 82  3.145925e-04 262.34421
#> 83  2.715722e-04 264.94106
#> 84  2.363867e-04 267.53791
#> 85  2.046344e-04 270.13476
#> 86  1.740851e-04 272.73161
#> 87  1.451818e-04 275.32846
#> 88  1.201927e-04 277.92531
#> 89  1.011247e-04 280.52216
#> 90  8.802978e-05 283.11901
#> 91  7.856866e-05 285.71587
#> 92  6.926795e-05 288.31272
#> 93  5.772550e-05 290.90957
#> 94  4.396555e-05 293.50642
#> 95  2.995201e-05 296.10327
#> 96  1.804901e-05 298.70012
#> 97  9.566197e-06 301.29697
#> 98  4.439118e-06 303.89382
#> 99  1.797090e-06 306.49067
#> 100 6.362330e-07 309.08753

# calculate distribution of minimum population sizes
#   but ignore first 10 years
get_pdf(sims, fn = max, times = 11:51)
#>             prob     value
#> 1   5.139556e-07  50.45373
#> 2   1.382402e-06  53.50099
#> 3   3.301176e-06  56.54826
#> 4   6.980480e-06  59.59552
#> 5   1.311964e-05  62.64278
#> 6   2.203316e-05  65.69005
#> 7   3.334875e-05  68.73731
#> 8   4.611694e-05  71.78458
#> 9   5.957102e-05  74.83184
#> 10  7.414723e-05  77.87911
#> 11  9.194610e-05  80.92637
#> 12  1.163763e-04  83.97363
#> 13  1.515585e-04  87.02090
#> 14  2.019736e-04  90.06816
#> 15  2.734383e-04  93.11543
#> 16  3.732287e-04  96.16269
#> 17  5.081046e-04  99.20996
#> 18  6.805240e-04 102.25722
#> 19  8.835783e-04 105.30449
#> 20  1.103090e-03 108.35175
#> 21  1.323799e-03 111.39901
#> 22  1.538675e-03 114.44628
#> 23  1.754957e-03 117.49354
#> 24  1.991876e-03 120.54081
#> 25  2.270473e-03 123.58807
#> 26  2.602631e-03 126.63534
#> 27  2.985222e-03 129.68260
#> 28  3.402942e-03 132.72987
#> 29  3.837538e-03 135.77713
#> 30  4.279789e-03 138.82439
#> 31  4.734332e-03 141.87166
#> 32  5.215303e-03 144.91892
#> 33  5.735664e-03 147.96619
#> 34  6.295233e-03 151.01345
#> 35  6.875486e-03 154.06072
#> 36  7.443821e-03 157.10798
#> 37  7.964586e-03 160.15525
#> 38  8.412553e-03 163.20251
#> 39  8.782587e-03 166.24977
#> 40  9.088886e-03 169.29704
#> 41  9.352709e-03 172.34430
#> 42  9.590519e-03 175.39157
#> 43  9.806364e-03 178.43883
#> 44  9.990320e-03 181.48610
#> 45  1.012254e-02 184.53336
#> 46  1.018009e-02 187.58062
#> 47  1.014827e-02 190.62789
#> 48  1.003171e-02 193.67515
#> 49  9.856622e-03 196.72242
#> 50  9.658922e-03 199.76968
#> 51  9.459745e-03 202.81695
#> 52  9.251971e-03 205.86421
#> 53  9.005821e-03 208.91148
#> 54  8.689387e-03 211.95874
#> 55  8.291439e-03 215.00600
#> 56  7.823827e-03 218.05327
#> 57  7.311720e-03 221.10053
#> 58  6.781848e-03 224.14780
#> 59  6.258094e-03 227.19506
#> 60  5.762475e-03 230.24233
#> 61  5.314150e-03 233.28959
#> 62  4.922771e-03 236.33686
#> 63  4.579813e-03 239.38412
#> 64  4.257257e-03 242.43138
#> 65  3.918487e-03 245.47865
#> 66  3.537936e-03 248.52591
#> 67  3.114081e-03 251.57318
#> 68  2.669881e-03 254.62044
#> 69  2.242562e-03 257.66771
#> 70  1.869534e-03 260.71497
#> 71  1.575669e-03 263.76223
#> 72  1.367569e-03 266.80950
#> 73  1.232235e-03 269.85676
#> 74  1.142213e-03 272.90403
#> 75  1.065683e-03 275.95129
#> 76  9.786384e-04 278.99856
#> 77  8.719105e-04 282.04582
#> 78  7.502911e-04 285.09309
#> 79  6.266341e-04 288.14035
#> 80  5.148141e-04 291.18761
#> 81  4.240159e-04 294.23488
#> 82  3.571868e-04 297.28214
#> 83  3.118545e-04 300.32941
#> 84  2.822974e-04 303.37667
#> 85  2.619667e-04 306.42394
#> 86  2.450356e-04 309.47120
#> 87  2.275306e-04 312.51847
#> 88  2.071842e-04 315.56573
#> 89  1.831842e-04 318.61299
#> 90  1.558834e-04 321.66026
#> 91  1.266232e-04 324.70752
#> 92  9.731309e-05 327.75479
#> 93  7.007494e-05 330.80205
#> 94  4.680036e-05 333.84932
#> 95  2.873689e-05 336.89658
#> 96  1.608749e-05 339.94384
#> 97  8.145854e-06 342.99111
#> 98  3.706530e-06 346.03837
#> 99  1.507045e-06 349.08564
#> 100 5.480926e-07 352.13290
```
