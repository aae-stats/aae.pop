<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Specify environmental and demographic stochasticity in models of
  population dynamics — stochasticity • aae.pop</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Specify environmental and demographic stochasticity in models of
  population dynamics — stochasticity" />
<meta property="og:description" content="Specify environmental stochasticity (random variation
  in vital rates) and demographic stochasticity (random variation
  in population outcomes)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aae.pop</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/get_started.html">get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/including_processes.html">Including processes</a>
    </li>
    <li>
      <a href="../articles/beyond_defaults.html">Beyond defaults</a>
    </li>
    <li>
      <a href="../articles/metapopulations.html">Metapopulations</a>
    </li>
    <li>
      <a href="../articles/multiple_species.html">Multiple species</a>
    </li>
    <li>
      <a href="../articles/templates.html">Species templates</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/macperch_example.html">Macquarie perch</a>
    </li>
    <li>
      <a href="../articles/scenarios_example.html">Comparing scenarios</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">documentation</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/aae-stats/aae.pop">
    <span class="fab fa fab fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Specify environmental and demographic stochasticity in models of
  population dynamics</h1>
    <small class="dont-index">Source: <a href='https://github.com/aae-stats/aae.pop/blob/master/R/stochasticity.R'><code>R/stochasticity.R</code></a></small>
    <div class="hidden name"><code>stochasticity.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Specify environmental stochasticity (random variation
  in vital rates) and demographic stochasticity (random variation
  in population outcomes).</p>
    </div>

    <pre class="usage"><span class='fu'>environmental_stochasticity</span><span class='op'>(</span><span class='va'>masks</span>, <span class='va'>funs</span><span class='op'>)</span>

<span class='fu'>demographic_stochasticity</span><span class='op'>(</span><span class='va'>masks</span>, <span class='va'>funs</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>masks</th>
      <td><p>a logical matrix or vector (or list of these)
defining cells affected by <code>funs</code>. See Details and
<code><a href='masks.html'>masks</a></code></p></td>
    </tr>
    <tr>
      <th>funs</th>
      <td><p>a function or list of functions with one element
for each element of <code>masks</code>. See Details</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Masks must be of the same dimension as the population
  dynamics matrix (in the case of environmental stochasticity)
  or have one element for each class (in the case of demographic
  stochasticity). Masks specify cells influenced by stochasticity
  according to <code>funs</code>. Additional details on masks are provided
  in <code><a href='masks.html'>masks</a></code>.</p>
<p>Functions must have at least one argument, a population
  dynamics matrix for environmental
  stochasticity or a vector of population abundances for
  demographic stochasticity. Functions must return an
  output of the same dimensions as the input,
  modified to reflect the effects of stochasticity on
  vital rates or population abundances.</p>
<p>Additional arguments to functions are supported and can be
  passed to <code><a href='simulate.html'>simulate</a></code> with the <code>args</code>,
  <code>args.dyn</code>, or <code>args.fn</code> arguments.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># define a population matrix (columns move to rows)</span>
<span class='va'>nclass</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>
<span class='va'>popmat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>, nrow <span class='op'>=</span> <span class='va'>nclass</span>, ncol <span class='op'>=</span> <span class='va'>nclass</span><span class='op'>)</span>
<span class='va'>popmat</span><span class='op'>[</span><span class='fu'><a href='masks.html'>reproduction</a></span><span class='op'>(</span><span class='va'>popmat</span>, dims <span class='op'>=</span> <span class='fl'>4</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>20</span><span class='op'>)</span>
<span class='va'>popmat</span><span class='op'>[</span><span class='fu'><a href='masks.html'>transition</a></span><span class='op'>(</span><span class='va'>popmat</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.3</span>, <span class='fl'>0.5</span>, <span class='fl'>0.65</span><span class='op'>)</span>

<span class='co'># define a dynamics object</span>
<span class='va'>dyn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dynamics.html'>dynamics</a></span><span class='op'>(</span><span class='va'>popmat</span><span class='op'>)</span>

<span class='co'># simulate from this without any form of stochasticity</span>
<span class='co'>#   (50 time steps, 100 replicates)</span>
<span class='va'>sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='simulate.html'>simulate</a></span><span class='op'>(</span><span class='va'>dyn</span>, nsim <span class='op'>=</span> <span class='fl'>100</span>, options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ntime <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># plot the simulated trajectories</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>sims</span><span class='op'>)</span>
</div><div class='input'>
<span class='co'># and plot</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>sims</span><span class='op'>)</span>
</div><div class='img'><img src='stochasticity-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># note that there is only one trajectory now because</span>
<span class='co'>#   this simulation is deterministic.</span>
<span class='co'>#</span>
<span class='co'># let's change that by adding some environmental stochasticity</span>
<span class='va'>envstoch</span> <span class='op'>&lt;-</span> <span class='fu'>environmental_stochasticity</span><span class='op'>(</span>
  masks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='fu'><a href='masks.html'>reproduction</a></span><span class='op'>(</span><span class='va'>popmat</span>, dims <span class='op'>=</span> <span class='fl'>4</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span>,
    <span class='fu'><a href='masks.html'>transition</a></span><span class='op'>(</span><span class='va'>popmat</span><span class='op'>)</span>
  <span class='op'>)</span>,
  funs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, lambda <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span>,
    <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='rng.html'>rmultiunit</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>1</span>, mean <span class='op'>=</span> <span class='va'>x</span>, sd <span class='op'>=</span> <span class='fl'>0.1</span> <span class='op'>*</span> <span class='va'>x</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># update the dynamics object and simulate from it</span>
<span class='va'>dyn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>dyn</span>, <span class='va'>envstoch</span><span class='op'>)</span>
<span class='va'>sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='simulate.html'>simulate</a></span><span class='op'>(</span>
  <span class='va'>dyn</span>,
  init <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>20</span>, <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>5</span><span class='op'>)</span>,
  nsim <span class='op'>=</span> <span class='fl'>100</span>,
  options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ntime <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>,
<span class='op'>)</span>

<span class='co'># the rmultiunit draws can be slow but we can speed</span>
<span class='co'>#   this up by calculating them once per generation</span>
<span class='co'>#   instead of once per replicate within each generation</span>
<span class='va'>envstoch</span> <span class='op'>&lt;-</span> <span class='fu'>environmental_stochasticity</span><span class='op'>(</span>
  masks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='fu'><a href='masks.html'>reproduction</a></span><span class='op'>(</span><span class='va'>popmat</span>, dims <span class='op'>=</span> <span class='fl'>4</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span>,
    <span class='fu'><a href='masks.html'>transition</a></span><span class='op'>(</span><span class='va'>popmat</span><span class='op'>)</span>
  <span class='op'>)</span>,
  funs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, lambda <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span>,
    <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>mean</span>, <span class='va'>sd</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>pnorm</a></span><span class='op'>(</span><span class='va'>mean</span> <span class='op'>+</span> <span class='va'>sd</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
    <span class='op'>}</span>
  <span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># this requires an argument "function" that takes the</span>
<span class='co'>#   current state of the population model in each</span>
<span class='co'>#   iteration and calculates the correct arguments to</span>
<span class='co'>#   pass to environmental_stochasticty</span>
<span class='va'>envstoch_function</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>obj</span>, <span class='va'>pop</span>, <span class='va'>iter</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>mat</span> <span class='op'>&lt;-</span> <span class='va'>obj</span><span class='op'>$</span><span class='va'>matrix</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>is.list</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>mat</span> <span class='op'>&lt;-</span> <span class='va'>mat</span><span class='op'>[[</span><span class='va'>iter</span><span class='op'>]</span><span class='op'>]</span>
  <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>aae.pop</span><span class='fu'>:::</span><span class='fu'><a href='rng.html'>unit_to_real</a></span><span class='op'>(</span>
    <span class='va'>mat</span><span class='op'>[</span><span class='fu'><a href='masks.html'>transition</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>)</span><span class='op'>]</span>, <span class='fl'>0.1</span> <span class='op'>*</span> <span class='va'>mat</span><span class='op'>[</span><span class='fu'><a href='masks.html'>transition</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>)</span><span class='op'>]</span>
  <span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mean <span class='op'>=</span> <span class='va'>out</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, sd <span class='op'>=</span> <span class='va'>out</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># update the dynamics object and simulate from it</span>
<span class='va'>dyn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>dyn</span>, <span class='va'>envstoch</span><span class='op'>)</span>
<span class='va'>sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='simulate.html'>simulate</a></span><span class='op'>(</span>
  <span class='va'>dyn</span>,
  init <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>20</span>, <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>5</span><span class='op'>)</span>,
  nsim <span class='op'>=</span> <span class='fl'>100</span>,
  args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>environmental_stochasticity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>envstoch_function</span><span class='op'>)</span><span class='op'>)</span>,
  options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>ntime <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>,
<span class='op'>)</span>

<span class='co'># a simple way to add demographic stochasticity is to change</span>
<span class='co'>#   the "updater" that converts the population at time t</span>
<span class='co'>#   to its value at time t + 1. The default in aae.pop</span>
<span class='co'>#   uses matrix multiplication of the vital rates matrix</span>
<span class='co'>#   and current population. A simple tweak is to update</span>
<span class='co'>#   with binomial draws. Note that this also requires a</span>
<span class='co'>#   change to the "tidy_abundances" option so that population</span>
<span class='co'>#   abundances are always integer values.</span>
<span class='va'>sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='simulate.html'>simulate</a></span><span class='op'>(</span>
  <span class='va'>dyn</span>,
  init <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>20</span>, <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>5</span><span class='op'>)</span>,
  nsim <span class='op'>=</span> <span class='fl'>100</span>,
  options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>update <span class='op'>=</span> <span class='va'>update_binomial_leslie</span>,
                 tidy_abundances <span class='op'>=</span> <span class='va'>floor</span><span class='op'>)</span>,
  args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    environmental_stochasticity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>envstoch_function</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># and can plot these again</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>sims</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://scholar.google.com.au/citations?user=oEmm1CMAAAAJ&hl=en'>Jian Yen</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


