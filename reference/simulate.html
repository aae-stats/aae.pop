<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate single or multispecies population dynamics in R — simulate • aae.pop</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate single or multispecies population dynamics in R — simulate"><meta name="description" content="Simulate population dynamics for one or more
  species defined by dynamics objects."><meta property="og:description" content="Simulate population dynamics for one or more
  species defined by dynamics objects."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aae.pop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/get_started.html">get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/including_processes.html">Including processes</a></li>
    <li><a class="dropdown-item" href="../articles/beyond_defaults.html">Beyond defaults</a></li>
    <li><a class="dropdown-item" href="../articles/metapopulations.html">Metapopulations</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_species.html">Multiple species</a></li>
    <li><a class="dropdown-item" href="../articles/templates.html">Species templates</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples"><li><a class="dropdown-item" href="../articles/macperch_example.html">Macquarie perch</a></li>
    <li><a class="dropdown-item" href="../articles/scenarios_example.html">Comparing scenarios</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/aae-stats/aae.pop"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate single or multispecies population dynamics in R</h1>
      <small class="dont-index">Source: <a href="https://github.com/aae-stats/aae.pop/blob/main/R/simulate.R" class="external-link"><code>R/simulate.R</code></a></small>
      <div class="d-none name"><code>simulate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Simulate population dynamics for one or more
  species defined by <code><a href="dynamics.html">dynamics</a></code> objects.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'dynamics'</span></span>
<span><span class="fu">simulate</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .future <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is.simulation</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is.simulation_list</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a <code>dynamics</code> object created with
<code><a href="dynamics.html">dynamics</a></code> or from a subsequent call to
<code><a href="multispecies.html">multispecies</a></code> or <code><a href="metapopulation.html">metapopulation</a></code>.
Alternatively, <code>object</code> can be the output of a
call to <code>simulate</code> in the case of <code>summary</code></p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>the number of replicate simulations (default = 1)</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>optional seed used prior to initialisation and simulation to
give reproducible results</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>ignored; included for consistency with <code>simulate</code> generic
method</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>an array of initial conditions with one row per replicate and one
column per population stage. If <code>obj</code> has been created with
<code><a href="multispecies.html">multispecies</a></code>, initial conditions can be provided as a list or
array with one element or slice per species, or as a matrix, in which case
all species are assumed to share the same initial conditions. Defaults
to <code>NULL</code>, in which case initial conditions are generated randomly
according to <code>options()$aae.pop_initialisation</code></p></dd>


<dt id="arg-options">options<a class="anchor" aria-label="anchor" href="#arg-options"></a></dt>
<dd><p>a named <code>list</code> of simulation options. Currently accepted
  values are:</p>
<p>- <code>ntime</code> the number of time steps to simulate, ignored if <code>obj</code>
      includes a <code><a href="covariates.html">covariates</a></code> (default = 50)</p>
<p>- <code>keep_slices</code> <code>logical</code> defining whether to keep intermediate
      population abundances or (if <code>FALSE</code>) to return only the final
      time slice</p>
<p>- <code>tidy_abundances</code> a function to handle predicted abundance data
      that may be non-integer. Defaults to <code>identity</code>; suggested
      alternatives are <code>floor</code>, <code>round</code>, or <code>ceiling</code></p>
<p>- <code>initialise_args</code> a list of arguments passed to the function
      used to initialise abundance trajectories. Only used if
      <code>init = NULL</code>. Defaults to <code>options()$aae.pop_lambda</code>,
      which specifies lambda for Poisson random draws. The default
      initialisation function is defined by
      <code>options()$aae.pop_initialisation</code>.</p>
<p>- <code>update</code> a function to update abundances from one time
      step to the next. Defaults to <code>options()$aae.pop_update</code>.</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>named list of lists passing arguments to processes defined
  in <code>object</code>, including <code>interaction</code> for
  <code><a href="multispecies.html">multispecies</a></code> objects. Lists (up to one per process)
  can contain a mix of static, dynamic, and function arguments.
  Dynamic arguments must be lists with one element per time step.
  Function arguments must be functions that calculate arguments
  dynamically in each generation based on from the population dynamics
  object, population abundances, and time step in each generation.
  All other classes (e.g., single values, matrices, data frames)
  are treated as static arguments. Covariates contained in numeric
  vectors, matrices, or data frames can be formatted as dynamic
  arguments with the <code>format_covariates</code> function.</p>
<p><code>args</code> for <code><a href="multispecies.html">multispecies</a></code> objects must have one
  element per species (defaults will expand automatically if not provided)</p></dd>


<dt id="arg--future">.future<a class="anchor" aria-label="anchor" href="#arg--future"></a></dt>
<dd><p>flag to determine whether the future package should be
used to manage updates for multispecies models (an embarrassingly
parallel problem)</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an object to pass to <code>is.simulation</code> or
<code>is.simulation.list</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Includes plot and subset methods</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># define a population matrix (columns move to rows)</span></span></span>
<span class="r-in"><span><span class="va">nclass</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">popmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">nclass</span>, ncol <span class="op">=</span> <span class="va">nclass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popmat</span><span class="op">[</span><span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popmat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.65</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can extract standard population matrix summary stats</span></span></span>
<span class="r-in"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define a dynamics object</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="dynamics.html">dynamics</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate from this (50 time steps, 100 replicates)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span><span class="va">dyn</span>, nsim <span class="op">=</span> <span class="fl">100</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the simulated trajectories</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="simulate-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add some density dependence</span></span></span>
<span class="r-in"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="density_dependence.html">density_dependence</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="fu"><a href="density_functions.html">ricker</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">dd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate again</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span><span class="va">dyn</span>, nsim <span class="op">=</span> <span class="fl">100</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="simulate-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># what if we want to add initial conditions?</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and plot again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="simulate-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># note that there is only one trajectory now because</span></span></span>
<span class="r-in"><span><span class="co">#   this simulation is deterministic.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># let's change that by adding some environmental stochasticity</span></span></span>
<span class="r-in"><span><span class="va">envstoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="stochasticity.html">environmental_stochasticity</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="rng.html">rmultiunit</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object and simulate from it</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">envstoch</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the rmultiunit draws can be slow but we can speed</span></span></span>
<span class="r-in"><span><span class="co">#   this up by calculating them once per generation</span></span></span>
<span class="r-in"><span><span class="co">#   instead of once per replicate within each generation</span></span></span>
<span class="r-in"><span><span class="va">envstoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="stochasticity.html">environmental_stochasticity</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># this requires an argument "function" that takes the</span></span></span>
<span class="r-in"><span><span class="co">#   current state of the population model in each</span></span></span>
<span class="r-in"><span><span class="co">#   iteration and calculates the correct arguments to</span></span></span>
<span class="r-in"><span><span class="co">#   pass to environmental_stochasticty</span></span></span>
<span class="r-in"><span><span class="va">envstoch_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>, <span class="va">pop</span>, <span class="va">iter</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">matrix</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[[</span><span class="va">iter</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">aae.pop</span><span class="fu">:::</span><span class="fu"><a href="rng.html">unit_to_real</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0.1</span> <span class="op">*</span> <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object and simulate from it</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">envstoch</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>environmental_stochasticity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">envstoch_function</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can also add covariates that influence vital rates</span></span></span>
<span class="r-in"><span><span class="co">#   e.g., a logistic function</span></span></span>
<span class="r-in"><span><span class="va">covars</span> <span class="op">&lt;-</span> <span class="fu"><a href="covariates.html">covariates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x</span><span class="op">)</span> <span class="va">mat</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate 50 random covariate values</span></span></span>
<span class="r-in"><span><span class="va">xvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object and simulate from it.</span></span></span>
<span class="r-in"><span><span class="co">#   Note that ntime is now captured in the 50 values</span></span></span>
<span class="r-in"><span><span class="co">#   of xvals, assuming we pass xvals as an argument</span></span></span>
<span class="r-in"><span><span class="co">#   to the covariates functions</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">covars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    covariates <span class="op">=</span> <span class="fu"><a href="covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    environmental_stochasticity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">envstoch_function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and can plot these again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># a simple way to add demographic stochasticity is to change</span></span></span>
<span class="r-in"><span><span class="co">#   the "updater" that converts the population at time t</span></span></span>
<span class="r-in"><span><span class="co">#   to its value at time t + 1. The default in aae.pop</span></span></span>
<span class="r-in"><span><span class="co">#   uses matrix multiplication of the vital rates matrix</span></span></span>
<span class="r-in"><span><span class="co">#   and current population. A simple tweak is to update</span></span></span>
<span class="r-in"><span><span class="co">#   with binomial draws. Note that this also requires a</span></span></span>
<span class="r-in"><span><span class="co">#   change to the "tidy_abundances" option so that population</span></span></span>
<span class="r-in"><span><span class="co">#   abundances are always integer values.</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    update <span class="op">=</span> <span class="va">update_binomial_leslie</span>,</span></span>
<span class="r-in"><span>    tidy_abundances <span class="op">=</span> <span class="va">floor</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    covariates <span class="op">=</span> <span class="fu"><a href="covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    environmental_stochasticity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">envstoch_function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and can plot these again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jian Yen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

