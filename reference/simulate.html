<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simulate single or multispecies population dynamics in R — simulate • aae.pop</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate single or multispecies population dynamics in R — simulate"><meta property="og:description" content="Simulate population dynamics for one or more
  species defined by dynamics or
  template objects."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aae.pop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/get_started.html">get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/including_processes.html">Including processes</a>
    </li>
    <li>
      <a href="../articles/beyond_defaults.html">Beyond defaults</a>
    </li>
    <li>
      <a href="../articles/metapopulations.html">Metapopulations</a>
    </li>
    <li>
      <a href="../articles/multiple_species.html">Multiple species</a>
    </li>
    <li>
      <a href="../articles/templates.html">Species templates</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/macperch_example.html">Macquarie perch</a>
    </li>
    <li>
      <a href="../articles/scenarios_example.html">Comparing scenarios</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/aae-stats/aae.pop" class="external-link">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate single or multispecies population dynamics in R</h1>
    <small class="dont-index">Source: <a href="https://github.com/aae-stats/aae.pop/blob/HEAD/R/simulate.R" class="external-link"><code>R/simulate.R</code></a></small>
    <div class="hidden name"><code>simulate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Simulate population dynamics for one or more
  species defined by <code><a href="dynamics.html">dynamics</a></code> or
  <code>template</code> objects.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for dynamics</span></span>
<span><span class="fu">simulate</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  args.dyn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  args.fn <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for template</span></span>
<span><span class="fu">simulate</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  args.dyn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  args.fn <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is.simulation</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is.simulation_list</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>a <code>dynamics</code> object created with
<code><a href="dynamics.html">dynamics</a></code> or from a subsequent call to
<code><a href="multispecies.html">multispecies</a></code> or <code><a href="metapopulation.html">metapopulation</a></code>.
Alternatively, <code>ojbect</code> can be a <code>template</code>
object from <span class="pkg">aae.pop.templates</span>, or the output of a
call to <code>simulate</code> in the case of <code>summary</code></p></dd>


<dt>nsim</dt>
<dd><p>the number of replicate simulations (default = 1)</p></dd>


<dt>seed</dt>
<dd><p>optional seed used prior to initialisation and simulation to
give reproducible results</p></dd>


<dt>...</dt>
<dd><p>ignored; included for consistency with <code>simulate</code> generic
method</p></dd>


<dt>init</dt>
<dd><p>an array of initial conditions with one row per replicate and one
column per population stage. If <code>obj</code> has been created with
<code><a href="multispecies.html">multispecies</a></code>, initial conditions can be provided as a list or
array with one element or slice per species, or as a matrix, in which case
all species are assumed to share the same initial conditions. Defaults
to <code>NULL</code>, in which case initial conditions are generated randomly
according to <code>options()$aae.pop_initialisation</code></p></dd>


<dt>options</dt>
<dd><p>a named <code>list</code> of simulation options. Currently accepted
  values are:</p>
<p>- <code>ntime</code> the number of time steps to simulate, ignored if <code>obj</code>
      includes a <code><a href="covariates.html">covariates</a></code> (default = 50)</p>
<p>- <code>keep_slices</code> <code>logical</code> defining whether to keep intermediate
      population abundances or (if <code>FALSE</code>) to return only the final
      time slice</p>
<p>- <code>tidy_abundances</code> a function to handle predicted abundance data
      that may be non-integer. Defaults to <code>identity</code>; suggested
      alternatives are <code>floor</code>, <code>round</code>, or <code>ceiling</code></p>
<p>- <code>initialise_args</code> a list of arguments passed to the function
      used to initialise abundance trajectories. Only used if
      <code>init = NULL</code>. Defaults to <code>options()$aae.pop_lambda</code>,
      which specifies lambda for Poisson random draws. The default
      initialisation function is defined by
      <code>options()$aae.pop_initialisation</code>.</p>
<p>- <code>update</code> a function to update abundances from one time
      step to the next. Defaults to <code>options()$aae.pop_update</code>.</p></dd>


<dt>args</dt>
<dd><p>named list of lists passing arguments to processes defined
in <code>object</code>, including <code>interaction</code> for
<code><a href="multispecies.html">multispecies</a></code> objects. Lists (up to one per process)
can contain a mix of static, dynamic, and function arguments.
Dynamic arguments must be lists with one element per time step.
Function arguments must be functions that calculate arguments
dynamically in each generation based on from the population dynamics
object, population abundances, and time step in each generation.
All other classes (e.g., single values, matrices, data frames)
are treated as static arguments. Covariates contained in numeric
vectors, matrices, or data frames can be formatted as dynamic
arguments with the <code>format_covariates</code> function</p></dd>


<dt>args.dyn</dt>
<dd><p>this argument is deprecated. List of time-varying
values of <code>args</code>. Defaults to <code>NULL</code> and requires one
element for each generation (specified by covariates or with
<code>options$ntime</code>). Dynamic arguments can now be passed directly
to <code>args</code></p></dd>


<dt>args.fn</dt>
<dd><p>this argument is deprecated.
Named list of functions evaluating additional values of
<code>args</code> based on the matrix and abundances in each generation.
Defaults to <code>NULL</code>. Function arguments can now be passed
directly to <code>args</code></p></dd>


<dt>x</dt>
<dd><p>an object to pass to <code>is.simulation</code> or
<code>is.simulation.list</code></p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Includes plot and subset methods</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># define a population matrix (columns move to rows)</span></span></span>
<span class="r-in"><span><span class="va">nclass</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">popmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">nclass</span>, ncol <span class="op">=</span> <span class="va">nclass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popmat</span><span class="op">[</span><span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popmat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.65</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can extract standard population matrix summary stats</span></span></span>
<span class="r-in"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define a dynamics object</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="dynamics.html">dynamics</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate from this (50 time steps, 100 replicates)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span><span class="va">dyn</span>, nsim <span class="op">=</span> <span class="fl">100</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the simulated trajectories</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="simulate-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add some density dependence</span></span></span>
<span class="r-in"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="density_dependence.html">density_dependence</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="fu"><a href="density_functions.html">ricker</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">dd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate again</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span><span class="va">dyn</span>, nsim <span class="op">=</span> <span class="fl">100</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="simulate-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># what if we want to add initial conditions?</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and plot again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="simulate-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># note that there is only one trajectory now because</span></span></span>
<span class="r-in"><span><span class="co">#   this simulation is deterministic.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># let's change that by adding some environmental stochasticity</span></span></span>
<span class="r-in"><span><span class="va">envstoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="stochasticity.html">environmental_stochasticity</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="rng.html">rmultiunit</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object and simulate from it</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">envstoch</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the rmultiunit draws can be slow but we can speed</span></span></span>
<span class="r-in"><span><span class="co">#   this up by calculating them once per generation</span></span></span>
<span class="r-in"><span><span class="co">#   instead of once per replicate within each generation</span></span></span>
<span class="r-in"><span><span class="va">envstoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="stochasticity.html">environmental_stochasticity</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">reproduction</a></span><span class="op">(</span><span class="va">popmat</span>, dims <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lambda <span class="op">=</span> <span class="va">x</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># this requires an argument "function" that takes the</span></span></span>
<span class="r-in"><span><span class="co">#   current state of the population model in each</span></span></span>
<span class="r-in"><span><span class="co">#   iteration and calculates the correct arguments to</span></span></span>
<span class="r-in"><span><span class="co">#   pass to environmental_stochasticty</span></span></span>
<span class="r-in"><span><span class="va">envstoch_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>, <span class="va">pop</span>, <span class="va">iter</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">matrix</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[[</span><span class="va">iter</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">aae.pop</span><span class="fu">:::</span><span class="fu"><a href="rng.html">unit_to_real</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">]</span>, <span class="fl">0.1</span> <span class="op">*</span> <span class="va">mat</span><span class="op">[</span><span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object and simulate from it</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">envstoch</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>environmental_stochasticity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">envstoch_function</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntime <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can also add covariates that influence vital rates</span></span></span>
<span class="r-in"><span><span class="co">#   e.g., a logistic function</span></span></span>
<span class="r-in"><span><span class="va">covars</span> <span class="op">&lt;-</span> <span class="fu"><a href="covariates.html">covariates</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  masks <span class="op">=</span> <span class="fu"><a href="masks.html">transition</a></span><span class="op">(</span><span class="va">popmat</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  funs <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">mat</span>, <span class="va">x</span><span class="op">)</span> <span class="va">mat</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulate 50 random covariate values</span></span></span>
<span class="r-in"><span><span class="va">xvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># update the dynamics object and simulate from it.</span></span></span>
<span class="r-in"><span><span class="co">#   Note that ntime is now captured in the 50 values</span></span></span>
<span class="r-in"><span><span class="co">#   of xvals, assuming we pass xvals as an argument</span></span></span>
<span class="r-in"><span><span class="co">#   to the covariates functions</span></span></span>
<span class="r-in"><span><span class="va">dyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">dyn</span>, <span class="va">covars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    covariates <span class="op">=</span> <span class="fu"><a href="covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    environmental_stochasticity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">envstoch_function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and can plot these again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># a simple way to add demographic stochasticity is to change</span></span></span>
<span class="r-in"><span><span class="co">#   the "updater" that converts the population at time t</span></span></span>
<span class="r-in"><span><span class="co">#   to its value at time t + 1. The default in aae.pop</span></span></span>
<span class="r-in"><span><span class="co">#   uses matrix multiplication of the vital rates matrix</span></span></span>
<span class="r-in"><span><span class="co">#   and current population. A simple tweak is to update</span></span></span>
<span class="r-in"><span><span class="co">#   with binomial draws. Note that this also requires a</span></span></span>
<span class="r-in"><span><span class="co">#   change to the "tidy_abundances" option so that population</span></span></span>
<span class="r-in"><span><span class="co">#   abundances are always integer values.</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">simulate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dyn</span>,</span></span>
<span class="r-in"><span>  init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    update <span class="op">=</span> <span class="va">update_binomial_leslie</span>,</span></span>
<span class="r-in"><span>    tidy_abundances <span class="op">=</span> <span class="va">floor</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    covariates <span class="op">=</span> <span class="fu"><a href="covariates.html">format_covariates</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    environmental_stochasticity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">envstoch_function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># and can plot these again</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jian Yen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

